"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[175],{175:(e,l,s)=>{s.r(l),s.d(l,{default:()=>q});var i=s(641),t=s(33);const a={class:"csv-files-container"},o={class:"csv-files-view"},r={class:"mb-4"},n={class:"row mb-4"},d={class:"col-md-6"},c={class:"col-md-6"},u={class:"guidelines"},h={key:0,class:"alert alert-warning alert-dismissible fade show",role:"alert"},p={class:"d-flex justify-content-between align-items-center"},f={key:0,class:"text-center py-5"},m={key:1,class:"text-center py-5 bg-light rounded"},k={key:2},g={class:"table-responsive"},v={class:"table table-hover"},b={class:"badge bg-info rounded-pill"},F={class:"btn-group btn-group-sm"},C={key:0,class:"spinner-border spinner-border-sm me-1","aria-hidden":"true"},L={key:1,class:"visually-hidden"},y={key:0,class:"modal fade",tabindex:"-1",style:{display:"block","background-color":"rgba(0,0,0,0.5)"}},E={class:"modal-dialog modal-dialog-centered"},w={class:"modal-content"},S={class:"modal-header"},D={class:"modal-body"},V={class:"modal-footer"},_=["disabled"],$={key:0,class:"spinner-border spinner-border-sm me-1","aria-hidden":"true"},W={key:1,class:"visually-hidden"};function X(e,l,s,X,I,P){const x=(0,i.g2)("router-link"),T=(0,i.g2)("csv-file-uploader"),U=(0,i.g2)("base-card"),A=(0,i.g2)("base-button");return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("div",o,[(0,i.Lk)("div",r,[(0,i.bF)(x,{to:"/",class:"btn btn-sm btn-outline-secondary"},{default:(0,i.k6)((()=>l[4]||(l[4]=[(0,i.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,i.eW)(" Back ")]))),_:1}),l[5]||(l[5]=(0,i.Lk)("h2",{class:"mt-3"},"CSV File Management",-1))]),(0,i.Lk)("div",n,[(0,i.Lk)("div",d,[(0,i.bF)(U,{title:"Upload CSV Mapping File"},{default:(0,i.k6)((()=>[(0,i.bF)(T,{onFileUploaded:P.handleFileUploaded,onFileProcessed:P.handleFileProcessed},null,8,["onFileUploaded","onFileProcessed"])])),_:1})]),(0,i.Lk)("div",c,[(0,i.bF)(U,{title:"CSV Files Information"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",u,[l[9]||(l[9]=(0,i.Lk)("h5",null,"About CSV Mapping Files",-1)),l[10]||(l[10]=(0,i.Lk)("p",null,"CSV files are used to link metadata to crop images:",-1)),l[11]||(l[11]=(0,i.Lk)("ul",null,[(0,i.Lk)("li",null,[(0,i.Lk)("strong",null,"Required:"),(0,i.eW)(" A 'sample_id' column is required to match images")]),(0,i.Lk)("li",null,[(0,i.Lk)("strong",null,"Processing:"),(0,i.eW)(" After uploading, click 'Process' to analyze the file")]),(0,i.Lk)("li",null,[(0,i.Lk)("strong",null,"Delete:"),(0,i.eW)(" You can remove files that are no longer needed")])],-1)),I.showDeletionWarning?((0,i.uX)(),(0,i.CE)("div",h,[l[6]||(l[6]=(0,i.Lk)("i",{class:"bi bi-info-circle me-2"},null,-1)),l[7]||(l[7]=(0,i.Lk)("strong",null,"Note:",-1)),l[8]||(l[8]=(0,i.eW)(" CSV files linked to images cannot be deleted until the link is removed. ")),(0,i.Lk)("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=e=>I.showDeletionWarning=!1),"aria-label":"Close"})])):(0,i.Q3)("",!0)])])),_:1})])]),(0,i.bF)(U,null,{header:(0,i.k6)((()=>[(0,i.Lk)("div",p,[l[13]||(l[13]=(0,i.Lk)("h5",{class:"mb-0"},"CSV Files",-1)),(0,i.Lk)("div",null,[(0,i.bF)(A,{size:"sm",variant:"outline-primary",onClick:P.refreshFiles,loading:P.loading},{default:(0,i.k6)((()=>l[12]||(l[12]=[(0,i.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,i.eW)(" Refresh ")]))),_:1},8,["onClick","loading"])])])])),default:(0,i.k6)((()=>[P.loading?((0,i.uX)(),(0,i.CE)("div",f,l[14]||(l[14]=[(0,i.Lk)("div",{class:"spinner-border text-primary","aria-hidden":"true"},null,-1),(0,i.Lk)("span",{class:"visually-hidden"},"Loading...",-1),(0,i.Lk)("p",{class:"mt-2 text-muted"},"Loading CSV files...",-1)]))):0===P.csvFiles.length?((0,i.uX)(),(0,i.CE)("div",m,l[15]||(l[15]=[(0,i.Lk)("div",{class:"display-1 text-muted mb-3"},[(0,i.Lk)("i",{class:"bi bi-file-earmark-spreadsheet"})],-1),(0,i.Lk)("h4",{class:"text-muted"},"No CSV Files Found",-1),(0,i.Lk)("p",{class:"text-muted"},"Upload CSV mapping files to get started.",-1)]))):((0,i.uX)(),(0,i.CE)("div",k,[(0,i.Lk)("div",g,[(0,i.Lk)("table",v,[l[18]||(l[18]=(0,i.Lk)("thead",{class:"table-light"},[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"File Name"),(0,i.Lk)("th",null,"Uploaded"),(0,i.Lk)("th",null,"Images"),(0,i.Lk)("th",null,"Actions")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(P.csvFiles,(e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,t.v_)(e.name),1),(0,i.Lk)("td",null,(0,t.v_)(P.formatDate(e.uploaded_at)),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",b,(0,t.v_)(e.crop_images_count||0),1)]),(0,i.Lk)("td",null,[(0,i.Lk)("div",F,[(0,i.bF)(A,{variant:"outline-primary",onClick:l=>P.viewRelatedImages(e.id)},{default:(0,i.k6)((()=>l[16]||(l[16]=[(0,i.eW)(" View Images ")]))),_:2},1032,["onClick"]),(0,i.bF)(A,{variant:"outline-success",onClick:l=>P.processFile(e.id),disabled:I.processing===e.id},{default:(0,i.k6)((()=>[I.processing===e.id?((0,i.uX)(),(0,i.CE)("span",C)):(0,i.Q3)("",!0),I.processing===e.id?((0,i.uX)(),(0,i.CE)("span",L,"Processing file...")):(0,i.Q3)("",!0),l[17]||(l[17]=(0,i.eW)(" Process "))])),_:2},1032,["onClick","disabled"])])])])))),128))])])])]))])),_:1})]),I.showDeleteConfirmation?((0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("div",E,[(0,i.Lk)("div",w,[(0,i.Lk)("div",S,[l[19]||(l[19]=(0,i.Lk)("h5",{class:"modal-title"},"Confirm Deletion",-1)),(0,i.Lk)("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:l[1]||(l[1]=(...e)=>P.cancelDelete&&P.cancelDelete(...e))})]),(0,i.Lk)("div",D,[(0,i.Lk)("p",null,[l[20]||(l[20]=(0,i.eW)("Are you sure you want to delete the CSV file ")),(0,i.Lk)("strong",null,(0,t.v_)(I.fileToDelete?.name),1),l[21]||(l[21]=(0,i.eW)("?"))]),l[22]||(l[22]=(0,i.Lk)("p",{class:"text-danger"},"This action cannot be undone and may affect related crop images.",-1))]),(0,i.Lk)("div",V,[(0,i.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:l[2]||(l[2]=(...e)=>P.cancelDelete&&P.cancelDelete(...e))},"Cancel"),(0,i.Lk)("button",{type:"button",class:"btn btn-danger",onClick:l[3]||(l[3]=(...e)=>P.deleteFile&&P.deleteFile(...e)),disabled:I.deleting},[I.deleting?((0,i.uX)(),(0,i.CE)("span",$)):(0,i.Q3)("",!0),I.deleting?((0,i.uX)(),(0,i.CE)("span",W,"Deleting file...")):(0,i.Q3)("",!0),l[23]||(l[23]=(0,i.eW)(" Delete "))],8,_)])])])])):(0,i.Q3)("",!0)])}var I=s(278),P=s(228),x=s(753),T=s(657);const U={name:"CsvFilesView",components:{BaseCard:P.A,BaseButton:x.A,CsvFileUploader:T.A},data(){return{processing:null,fileToDelete:null,showDeleteConfirmation:!1,deleting:!1,showDeletionWarning:!0}},computed:{...(0,I.L8)("crop",["getCsvFiles","isLoading"]),csvFiles(){return this.getCsvFiles||[]},loading(){return this.isLoading}},mounted(){this.fetchCsvFiles()},methods:{...(0,I.i0)("crop",["fetchCsvFiles","processCsvFile","deleteCsvFile"]),refreshFiles(){this.fetchCsvFiles()},handleFileUploaded(e){this.$toast?.success(`File "${e.title}" uploaded successfully!`),this.refreshFiles()},handleFileProcessed(e){this.$toast?.success(`File processed successfully! ${e.created} records created.`),this.refreshFiles()},async processFile(e){this.processing=e;try{const l=await this.processCsvFile(e);this.$toast?.success(`CSV file processed: ${l.created} created, ${l.updated} updated`),this.refreshFiles()}catch(l){console.error("Error processing file:",l),this.$toast?.error("Failed to process file. Please try again.")}finally{this.processing=null}},viewRelatedImages(e){this.$router.push({name:"crop-images",query:{csv_file:e}})},formatDate(e){if(!e)return"";const l=new Date(e);return l.toLocaleString()},confirmDelete(e){this.fileToDelete=e,this.showDeleteConfirmation=!0},cancelDelete(){this.fileToDelete=null,this.showDeleteConfirmation=!1},async deleteFile(){this.deleting=!0;const e=await this.$store.dispatch("deleteCsvFile",this.fileToDelete.id);e.success?(this.showDeleteConfirmation=!1,this.fileToDelete=null,this.$toast.success("File deleted successfully"),this.refreshFiles()):(console.error("Error deleting file:",e.error),e.linkedToImages?(this.showDeletionWarning=!0,this.$toast.error(e.error,{timeout:6e3}),setTimeout((()=>{this.viewRelatedImages(this.fileToDelete.id)}),1500)):this.$toast.error(`Error deleting file: ${e.error}`)),this.deleting=!1,this.showDeleteConfirmation=!1}}};var A=s(262);const Q=(0,A.A)(U,[["render",X],["__scopeId","data-v-131f2294"]]),q=Q},657:(e,l,s)=>{s.d(l,{A:()=>E});var i=s(641),t=s(751),a=s(33);const o={class:"csv-uploader card"},r={class:"card-body"},n={class:"mb-3"},d={class:"mb-3"},c={key:0,class:"invalid-feedback"},u={class:"d-grid gap-2"},h=["disabled"],p={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},f={key:1,class:"visually-hidden"},m={key:0,class:"alert alert-success mt-3",role:"alert"},k=["disabled"],g={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},v={key:1,class:"visually-hidden"};function b(e,l,s,b,F,C){return(0,i.uX)(),(0,i.CE)("div",o,[l[10]||(l[10]=(0,i.Lk)("div",{class:"card-header bg-light"},[(0,i.Lk)("h5",{class:"mb-0"},"Upload CSV Mapping File")],-1)),(0,i.Lk)("div",r,[(0,i.Lk)("form",{onSubmit:l[2]||(l[2]=(0,t.D$)(((...e)=>C.uploadFile&&C.uploadFile(...e)),["prevent"]))},[(0,i.Lk)("div",n,[l[4]||(l[4]=(0,i.Lk)("label",{for:"fileTitle",class:"form-label"},"Title",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",class:"form-control",id:"fileTitle","onUpdate:modelValue":l[0]||(l[0]=e=>F.title=e),placeholder:"Enter a descriptive title",required:""},null,512),[[t.Jo,F.title]])]),(0,i.Lk)("div",d,[l[5]||(l[5]=(0,i.Lk)("label",{for:"csvFile",class:"form-label"},"CSV File",-1)),(0,i.Lk)("input",{type:"file",class:(0,a.C4)(["form-control",{"is-invalid":F.fileError}]),id:"csvFile",onChange:l[1]||(l[1]=(...e)=>C.handleFileSelection&&C.handleFileSelection(...e)),accept:".csv",required:""},null,34),F.fileError?((0,i.uX)(),(0,i.CE)("div",c,(0,a.v_)(F.fileError),1)):(0,i.Q3)("",!0),l[6]||(l[6]=(0,i.Lk)("div",{class:"form-text"},[(0,i.eW)("Upload a CSV file containing a "),(0,i.Lk)("code",null,"F5 Code"),(0,i.eW)(" column to match with your fruit images.")],-1))]),(0,i.Lk)("div",u,[(0,i.Lk)("button",{type:"submit",class:"btn btn-success",disabled:!F.selectedFile||C.loading},[C.loading?((0,i.uX)(),(0,i.CE)("span",p)):(0,i.Q3)("",!0),C.loading?((0,i.uX)(),(0,i.CE)("span",f,"Loading...")):(0,i.Q3)("",!0),l[7]||(l[7]=(0,i.eW)(" Upload CSV File "))],8,h)])],32),F.uploadSuccess?((0,i.uX)(),(0,i.CE)("div",m,[l[9]||(l[9]=(0,i.eW)(" CSV file uploaded successfully! ")),(0,i.Lk)("button",{onClick:l[3]||(l[3]=(...e)=>C.processFile&&C.processFile(...e)),class:"btn btn-sm btn-outline-success ms-2",disabled:F.processing},[F.processing?((0,i.uX)(),(0,i.CE)("span",g)):(0,i.Q3)("",!0),F.processing?((0,i.uX)(),(0,i.CE)("span",v,"Processing...")):(0,i.Q3)("",!0),l[8]||(l[8]=(0,i.eW)(" Process Now "))],8,k)])):(0,i.Q3)("",!0)])])}var F=s(278);const C={name:"CsvFileUploader",data(){return{title:"",selectedFile:null,uploadSuccess:!1,uploadedFileId:null,processing:!1,fileError:""}},computed:{...(0,F.L8)(["isLoading"]),loading(){return this.isLoading}},methods:{...(0,F.i0)("crop",["uploadCsvFile","processCsvFile"]),handleFileSelection(e){this.fileError="";const l=e.target.files[0];if(!l)return;if(!l.name.toLowerCase().endsWith(".csv"))return this.fileError="Please select a valid CSV file",void(this.selectedFile=null);if(l.size>10485760)return this.fileError="File size exceeds the maximum limit of 10MB",void(this.selectedFile=null);const s=new FileReader;s.onload=e=>{try{const s=e.target.result,i=s.split("\n").filter((e=>""!==e.trim()));if(0===i.length)return this.fileError="CSV file appears to be empty",void(this.selectedFile=null);const t=i[0].toLowerCase(),a=t.split(",").length;if(a<2)return this.fileError="CSV file must have at least two columns",void(this.selectedFile=null);if(!t.includes("f5 code"))return this.fileError='CSV file must contain a "F5 Code" column',void(this.selectedFile=null);if(i.length>1)for(let e=1;e<Math.min(5,i.length);e++){const l=i[e].split(",").length;if(l!==a)return this.fileError="CSV file has inconsistent column counts. Please check your data.",void(this.selectedFile=null)}this.selectedFile=l,this.title||(this.title=l.name.replace(/\.csv$/i,""))}catch(s){console.error("Error parsing CSV header:",s),this.fileError="Error reading file. Please try again.",this.selectedFile=null}},s.onerror=()=>{this.fileError="Error reading file. Please try again.",this.selectedFile=null},s.readAsText(l)},async uploadFile(){if(this.selectedFile)try{const e=new FormData;e.append("name",this.title),e.append("file",this.selectedFile);const l=await this.uploadCsvFile(e);this.uploadSuccess=!0,this.uploadedFileId=l.id,this.$emit("file-uploaded",l),this.$toast?.success("CSV file uploaded successfully!"),this.resetForm()}catch(e){console.error("Error uploading file:",e),this.$toast?.error("Failed to upload file. Please try again.")}},async processFile(){if(this.uploadedFileId){this.processing=!0;try{const e=await this.processCsvFile(this.uploadedFileId);this.$toast?.success(`CSV file processed successfully! ${e.created} records created.`),this.$emit("file-processed",{id:this.uploadedFileId,result:e})}catch(e){console.error("Error processing file:",e),this.$toast?.error("Failed to process file. Please try again.")}finally{this.processing=!1,this.uploadSuccess=!1,this.uploadedFileId=null}}},resetForm(){this.title="",this.selectedFile=null,this.uploadSuccess=!1;const e=document.getElementById("csvFile");e&&(e.value=""),this.$nextTick((()=>{const e=document.querySelector(".csv-uploader");e&&(e.style.opacity="0.99"),setTimeout((()=>{e&&(e.style.opacity="1")}),10)}))}}};var L=s(262);const y=(0,L.A)(C,[["render",b],["__scopeId","data-v-7587e620"]]),E=y}}]);
//# sourceMappingURL=175.c441135d.js.map