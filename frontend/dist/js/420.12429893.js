"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[420],{420:(e,a,t)=>{t.r(a),t.d(a,{default:()=>$a});var l=t(641),s=t(33);const i={class:"crop-images-view-container"},d={class:"crop-images-view"},o={class:"mb-4"},n={class:"row mb-4"},r={class:"col-md-6"},c={class:"col-md-6"},m={class:"d-flex justify-content-between align-items-center"},u={class:"modal fade",id:"metadataEditorModal",tabindex:"-1","aria-labelledby":"metadataEditorModalLabel","aria-hidden":"true",ref:"metadataModal"},p={class:"modal-dialog modal-lg"},g={class:"modal-content"},b={class:"modal-header"},h={class:"modal-title",id:"metadataEditorModalLabel"},k={class:"modal-body"},v={key:0},f={class:"row mb-3"},L={class:"col-md-4"},y={class:"image-preview"},C=["src","alt"],I={key:1,class:"no-image"},F={class:"col-md-8"},w={class:"modal-footer"};function M(e,a,t,M,E,_){const S=(0,l.g2)("router-link"),V=(0,l.g2)("crop-image-uploader"),X=(0,l.g2)("base-card"),x=(0,l.g2)("csv-file-uploader"),P=(0,l.g2)("base-button"),U=(0,l.g2)("crop-image-gallery"),$=(0,l.g2)("metadata-editor"),A=(0,l.g2)("naming-guide-modal");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",d,[(0,l.Lk)("div",o,[(0,l.bF)(S,{to:"/",class:"btn btn-sm btn-outline-secondary"},{default:(0,l.k6)((()=>a[1]||(a[1]=[(0,l.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,l.eW)(" Back ")]))),_:1}),a[3]||(a[3]=(0,l.Lk)("h2",{class:"mt-3 d-inline-block me-2"},"Crop Image Management",-1)),(0,l.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>_.showNamingGuide&&_.showNamingGuide(...e)),class:"btn btn-sm btn-outline-success"},a[2]||(a[2]=[(0,l.Lk)("i",{class:"bi bi-info-circle me-1"},null,-1),(0,l.eW)(" Naming Guide ")]))]),(0,l.Lk)("div",n,[(0,l.Lk)("div",r,[(0,l.bF)(X,{title:"Upload Images"},{default:(0,l.k6)((()=>[(0,l.bF)(V,{onImagesUploaded:_.refreshImages},null,8,["onImagesUploaded"])])),_:1})]),(0,l.Lk)("div",c,[(0,l.bF)(X,{title:"Upload CSV Mapping File"},{default:(0,l.k6)((()=>[(0,l.bF)(x,{onFileUploaded:_.refreshCsvFiles,onFileProcessed:_.handleCsvProcessed},null,8,["onFileUploaded","onFileProcessed"])])),_:1})])]),(0,l.bF)(X,null,{header:(0,l.k6)((()=>[(0,l.Lk)("div",m,[a[5]||(a[5]=(0,l.Lk)("h5",{class:"mb-0"},"Crop Image Gallery",-1)),(0,l.Lk)("div",null,[(0,l.bF)(P,{size:"sm",variant:"outline-primary",onClick:_.refreshImages,loading:_.loading},{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,l.eW)(" Refresh ")]))),_:1},8,["onClick","loading"])])])])),default:(0,l.k6)((()=>[(0,l.bF)(U,{onEditImage:_.editImage,onAddImages:_.scrollToUploader},null,8,["onEditImage","onAddImages"])])),_:1}),(0,l.Lk)("div",u,[(0,l.Lk)("div",p,[(0,l.Lk)("div",g,[(0,l.Lk)("div",b,[(0,l.Lk)("h5",h," Edit Metadata: "+(0,s.v_)(E.selectedImage?E.selectedImage.sample_id:""),1),a[6]||(a[6]=(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),(0,l.Lk)("div",k,[E.selectedImage?((0,l.uX)(),(0,l.CE)("div",v,[(0,l.Lk)("div",f,[(0,l.Lk)("div",L,[(0,l.Lk)("div",y,[E.selectedImage.image_url?((0,l.uX)(),(0,l.CE)("img",{key:0,src:E.selectedImage.image_url,class:"img-fluid rounded",alt:E.selectedImage.sample_id},null,8,C)):((0,l.uX)(),(0,l.CE)("div",I,"No Image Available"))])]),(0,l.Lk)("div",F,[(0,l.bF)($,{"image-id":E.selectedImage.id,"initial-metadata":E.selectedImage.metadata,onMetadataUpdated:_.handleMetadataUpdated},null,8,["image-id","initial-metadata","onMetadataUpdated"])])])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",w,[(0,l.bF)(P,{variant:"secondary","data-bs-dismiss":"modal"},{default:(0,l.k6)((()=>a[7]||(a[7]=[(0,l.eW)("Close")]))),_:1})])])])],512)]),(0,l.bF)(A,{ref:"namingGuideModal"},null,512)])}var E=t(278),_=t(228),S=t(753),V=t(751);const X={class:"image-uploader card"},x={class:"card-body"},P={class:"mb-3"},U=["value"],$={class:"mb-3"},A={class:"mb-3"},D={key:0,class:"selected-files mb-3"},W={class:"list-group"},T={key:0,class:"list-group-item text-center"},N={key:1,class:"progress mb-3"},B=["value"],G={class:"d-grid gap-2"},Q=["disabled"],R={key:0,class:"spinner-border spinner-border-sm me-2"},O={key:0,class:"alert alert-success mt-3"};function j(e,a,t,i,d,o){return(0,l.uX)(),(0,l.CE)("div",X,[a[12]||(a[12]=(0,l.Lk)("div",{class:"card-header bg-light"},[(0,l.Lk)("h5",{class:"mb-0"},"Upload Crop Images")],-1)),(0,l.Lk)("div",x,[(0,l.Lk)("form",{onSubmit:a[3]||(a[3]=(0,V.D$)(((...a)=>e.uploadImages&&e.uploadImages(...a)),["prevent"]))},[(0,l.Lk)("div",P,[a[5]||(a[5]=(0,l.Lk)("label",{for:"csvFile",class:"form-label"},[(0,l.eW)(" CSV Mapping File "),(0,l.Lk)("i",{class:"bi bi-info-circle ms-1","data-bs-toggle":"tooltip",title:"Choose a CSV file that contains sample IDs and metadata for your crop images."})],-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select",id:"csvFile","onUpdate:modelValue":a[0]||(a[0]=a=>e.selectedCsvId=a),required:""},[a[4]||(a[4]=(0,l.Lk)("option",{value:""},"Select a CSV mapping file",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.csvFiles,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,s.v_)(e.name||"Unnamed File"),9,U)))),128))],512),[[V.u1,e.selectedCsvId]]),a[6]||(a[6]=(0,l.Lk)("div",{class:"form-text"},"This links your images to sample IDs and metadata in the CSV file.",-1))]),(0,l.Lk)("div",$,[a[7]||(a[7]=(0,l.Lk)("label",{for:"sampleIdPrefix",class:"form-label"},"Sample ID Prefix",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"sampleIdPrefix","onUpdate:modelValue":a[1]||(a[1]=a=>e.sampleIdPrefix=a),placeholder:"IMG"},null,512),[[V.Jo,e.sampleIdPrefix]]),a[8]||(a[8]=(0,l.Lk)("div",{class:"form-text"},"Images will be named with this prefix followed by sequential numbers.",-1))]),(0,l.Lk)("div",A,[a[9]||(a[9]=(0,l.Lk)("label",{for:"cropImages",class:"form-label"},"Crop Images Folder",-1)),(0,l.Lk)("input",{type:"file",class:"form-control",id:"cropImages",onChange:a[2]||(a[2]=(...a)=>e.handleFileSelection&&e.handleFileSelection(...a)),accept:"image/*",multiple:"",required:"",webkitdirectory:"",directory:""},null,32),a[10]||(a[10]=(0,l.Lk)("div",{class:"form-text"},"Choose a folder containing valid crop images.",-1))]),e.selectedFiles.length>0?((0,l.uX)(),(0,l.CE)("div",D,[(0,l.Lk)("h6",null,"Selected Files ("+(0,s.v_)(e.selectedFiles.length)+"):",1),(0,l.Lk)("ul",W,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.selectedFilesToShow,((a,t)=>((0,l.uX)(),(0,l.CE)("li",{key:t,class:"list-group-item"},(0,s.v_)(a.name)+" ("+(0,s.v_)(e.formatFileSize(a.size))+") ",1)))),128)),e.selectedFiles.length>5?((0,l.uX)(),(0,l.CE)("li",T," ... and "+(0,s.v_)(e.selectedFiles.length-5)+" more files ",1)):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0),e.uploading?((0,l.uX)(),(0,l.CE)("div",N,[(0,l.Lk)("progress",{value:e.uploadProgress,max:"100",class:"w-100","aria-label":"Upload progress"},(0,s.v_)(e.uploadProgress)+"% ",9,B)])):(0,l.Q3)("",!0),(0,l.Lk)("div",G,[(0,l.Lk)("button",{type:"submit",class:"btn btn-success",disabled:!e.selectedFiles.length||!e.selectedCsvId||e.uploading},[e.uploading?((0,l.uX)(),(0,l.CE)("span",R)):(0,l.Q3)("",!0),a[11]||(a[11]=(0,l.eW)(" Upload Images "))],8,Q)])],32),e.uploadSuccess?((0,l.uX)(),(0,l.CE)("div",O,(0,s.v_)(e.uploadedFiles)+" images uploaded successfully! ",1)):(0,l.Q3)("",!0)])])}const q=(0,l.pM)({data(){return{selectedCsvId:"",sampleIdPrefix:"CROP",selectedFiles:[],uploading:!1,uploadProgress:0,uploadSuccess:!1,uploadedFiles:0,validationErrors:[],csvVersions:{}}},computed:{...(0,E.L8)("crop",["getCsvFiles"]),csvFiles(){return this.getCsvFiles},selectedFilesToShow(){return this.selectedFiles.slice(0,5)}},mounted(){this.fetchCsvFiles()},methods:{...(0,E.i0)("crop",["fetchCsvFiles","uploadCropImages","fetchCsvFile"]),handleFileSelection(e){const a=e.target.files;if(!a.length)return;let t="";if(a.length>0&&a[0].webkitRelativePath){const e=a[0].webkitRelativePath.split("/");e.length>1&&(t=e[0])}t&&console.log(`Selected folder: ${t}`);const l=["image/jpeg","image/png","image/gif"],s=Array.from(a).filter((e=>l.includes(e.type))),i=Array.from(a).filter((e=>!l.includes(e.type)));this.selectedFiles=s,i.length>0&&(console.warn("Warning: Some selected files are not supported image formats:",i.map((e=>e.name))),this.$toast?.warning(`${i.length} files skipped - only JPG, PNG, and GIF formats are supported.`)),0!==this.selectedFiles.length?(this.$toast?.info(`Found ${this.selectedFiles.length} valid image files in ${t||"selected folder"}.`),this.uploadSuccess=!1):this.$toast?.error("No valid image files found in the selected folder. Please select a folder containing images.")},async uploadImages(){this.uploading=!0,this.uploadProgress=0,this.uploadSuccess=!1,this.validationErrors=[];const e=setInterval((()=>{this.uploadProgress<90&&(this.uploadProgress+=5)}),300);try{if(!this.selectedCsvId)throw new Error("Please select a CSV file first");const a=await this.fetchCsvDetails(this.selectedCsvId),t=await this.validateImagesWithCsv(a);if(!t)return clearInterval(e),void(this.uploading=!1);const l=new FormData;l.append("csv_id",this.selectedCsvId),l.append("sample_id_prefix",this.sampleIdPrefix),this.selectedFiles.forEach((e=>{l.append("images",e)}));const s=await this.uploadCropImages(l);this.uploadProgress=100,clearInterval(e),s&&s.images&&s.images.length>0?(this.uploadSuccess=!0,this.uploadedFiles=s.images.length,this.$toast?.success(`Successfully uploaded ${this.uploadedFiles} images!`),this.$emit("images-uploaded",s.images)):(console.error("Upload error: Server returned success but no images"),this.$toast?.error("Upload failed. No images were saved."),this.uploadSuccess=!1),this.resetForm()}catch(a){console.error("Error uploading images:",a),this.$toast?.error("Failed to upload images. Please try again.")}finally{setTimeout((()=>{this.uploading=!1}),500)}},resetForm(){this.selectedFiles=[],this.uploadSuccess=!1,this.uploadedFiles=0;const e=document.getElementById("cropImages");e&&(e.value=""),this.$nextTick((()=>{const e=document.querySelector(".image-uploader");e&&(e.style.opacity="0.99",setTimeout((()=>{e&&(e.style.opacity="1")}),10))}))},formatFileSize(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"},formatDate(e){const a=new Date(e);return new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"short"}).format(a)},async fetchCsvDetails(e){try{const a=await this.fetchCsvFile(e);return a}catch(a){throw console.error("Error fetching CSV details:",a),new Error("Failed to fetch CSV file details")}},validateImagesWithCsv(e){return e.processed?!(!e.metadata||!e.metadata.sample_ids||0===e.metadata.sample_ids.length)||(this.$toast?.error("CSV file does not contain any sample IDs. Please check the file format."),!1):(this.$toast?.error("CSV file has not been processed yet. Please process it first."),!1)}}});var K=t(262);const J=(0,K.A)(q,[["render",j],["__scopeId","data-v-6446c51f"]]),z=J;var H=t(461);const Y={class:"crop-image-gallery"},Z={class:"card mb-4"},ee={class:"card-header bg-light d-flex justify-content-between align-items-center"},ae={key:0,class:"card-body"},te={class:"row g-3"},le={class:"col-md-4"},se=["value"],ie={class:"col-md-4"},de={class:"col-md-4"},oe=["value"],ne={key:0,class:"text-danger small mt-1"},re={key:0,class:"col-md-4"},ce={class:"d-flex justify-content-end mt-3"},me=["disabled"],ue={key:0,class:"text-center py-5"},pe={key:1,class:"text-center py-5 bg-light rounded"},ge={class:"mt-3"},be={key:2},he={class:"d-flex justify-content-between mb-3 align-items-center"},ke={class:"btn-group"},ve={key:0,class:"row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4"},fe={key:1,class:"list-view"},Le={class:"table-responsive"},ye={class:"table table-hover"},Ce={class:"image-cell"},Ie=["src","alt"],Fe={key:1,class:"no-image"},we={key:0,class:"metadata-badges"},Me={key:0,class:"badge bg-secondary"},Ee={key:1,class:"text-muted"},_e={class:"btn-group btn-group-sm"},Se=["onClick"],Ve=["onClick"],Xe={key:2,class:"text-center mt-4"},xe=["disabled"],Pe={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},Ue={class:"modal fade",id:"imageDetailsModal",tabindex:"-1","aria-labelledby":"imageDetailsModalLabel","aria-hidden":"true",ref:"imageModal"},$e={class:"modal-dialog modal-lg"},Ae={class:"modal-content"},De={class:"modal-header"},We={class:"modal-title",id:"imageDetailsModalLabel"},Te={key:0,class:"modal-body"},Ne={class:"row"},Be={class:"col-md-6"},Ge={class:"image-container mb-3"},Qe=["src","alt"],Re={key:1,class:"no-image-large"},Oe={class:"image-info"},je={key:0,class:"mb-2"},qe={class:"text-muted mb-2"},Ke={key:1,class:"text-muted mb-0"},Je={class:"col-md-6"},ze={key:0},He={class:"table table-sm"},Ye={key:1,class:"alert alert-info"},Ze={class:"modal-footer"};function ea(e,a,t,i,d,o){const n=(0,l.g2)("crop-image-card");return(0,l.uX)(),(0,l.CE)("div",Y,[(0,l.Lk)("div",Z,[(0,l.Lk)("div",ee,[a[12]||(a[12]=(0,l.Lk)("h5",{class:"mb-0"},"Image Filters",-1)),(0,l.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:a[0]||(a[0]=(...e)=>o.toggleFilters&&o.toggleFilters(...e))},(0,s.v_)(d.showFilters?"Hide Filters":"Show Filters"),1)]),d.showFilters?((0,l.uX)(),(0,l.CE)("div",ae,[(0,l.Lk)("div",te,[(0,l.Lk)("div",le,[a[14]||(a[14]=(0,l.Lk)("label",{for:"csvFileFilter",class:"form-label"},"CSV File",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select",id:"csvFileFilter","onUpdate:modelValue":a[1]||(a[1]=e=>d.filters.csvFile=e)},[a[13]||(a[13]=(0,l.Lk)("option",{value:""},"All CSV Files",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.csvFiles,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e.id,value:e.id},(0,s.v_)(e.name),9,se)))),128))],512),[[V.u1,d.filters.csvFile]])]),(0,l.Lk)("div",ie,[a[15]||(a[15]=(0,l.Lk)("label",{for:"sampleIdFilter",class:"form-label"},"Sample ID",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"sampleIdFilter","onUpdate:modelValue":a[2]||(a[2]=e=>d.filters.sampleId=e),placeholder:"Filter by sample ID"},null,512),[[V.Jo,d.filters.sampleId]])]),(0,l.Lk)("div",de,[a[18]||(a[18]=(0,l.Lk)("label",{for:"metadataLabelFilter",class:"form-label"},"Metadata Label",-1)),(0,l.bo)((0,l.Lk)("select",{class:"form-select",id:"metadataLabelFilter","onUpdate:modelValue":a[3]||(a[3]=e=>d.filters.metadataLabel=e)},[a[16]||(a[16]=(0,l.Lk)("option",{value:""},"All Labels",-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.metadataLabels,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},(0,s.v_)(e),9,oe)))),128))],512),[[V.u1,d.filters.metadataLabel]]),0===o.metadataLabels.length?((0,l.uX)(),(0,l.CE)("div",ne,a[17]||(a[17]=[(0,l.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-1"},null,-1),(0,l.eW)(" No metadata labels found ")]))):(0,l.Q3)("",!0)]),d.filters.metadataLabel?((0,l.uX)(),(0,l.CE)("div",re,[a[19]||(a[19]=(0,l.Lk)("label",{for:"metadataValueFilter",class:"form-label"},"Metadata Value",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"metadataValueFilter","onUpdate:modelValue":a[4]||(a[4]=e=>d.filters.metadataValue=e),placeholder:"Filter by value"},null,512),[[V.Jo,d.filters.metadataValue]])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",ce,[(0,l.Lk)("button",{class:"btn btn-sm btn-outline-danger me-2",onClick:a[5]||(a[5]=(...e)=>o.clearFilters&&o.clearFilters(...e)),disabled:!o.hasActiveFilters}," Clear Filters ",8,me),(0,l.Lk)("button",{class:"btn btn-sm btn-primary",onClick:a[6]||(a[6]=(...e)=>o.applyFilters&&o.applyFilters(...e))}," Apply Filters ")])])):(0,l.Q3)("",!0)]),o.loading?((0,l.uX)(),(0,l.CE)("div",ue,a[20]||(a[20]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,l.Lk)("p",{class:"mt-2 text-muted"},"Loading images...",-1)]))):0===o.cropImages.length?((0,l.uX)(),(0,l.CE)("div",pe,[a[21]||(a[21]=(0,l.Lk)("div",{class:"display-1 text-muted mb-3"},[(0,l.Lk)("i",{class:"bi bi-images"})],-1)),a[22]||(a[22]=(0,l.Lk)("h4",{class:"text-muted"},"No Images Found",-1)),a[23]||(a[23]=(0,l.Lk)("p",{class:"text-muted"},"Try adjusting your filters or upload new images.",-1)),(0,l.Lk)("div",ge,[(0,l.Lk)("button",{class:"btn btn-primary",onClick:a[7]||(a[7]=a=>e.$emit("add-images"))}," Upload Images ")])])):((0,l.uX)(),(0,l.CE)("div",be,[(0,l.Lk)("div",he,[(0,l.Lk)("h5",null,(0,s.v_)(o.cropImages.length)+" Images Found",1),(0,l.Lk)("div",ke,[(0,l.Lk)("button",{class:(0,s.C4)(["btn btn-sm",{"btn-primary":"grid"===d.viewMode,"btn-outline-primary":"grid"!==d.viewMode}]),onClick:a[8]||(a[8]=e=>d.viewMode="grid")}," Grid ",2),(0,l.Lk)("button",{class:(0,s.C4)(["btn btn-sm",{"btn-primary":"list"===d.viewMode,"btn-outline-primary":"list"!==d.viewMode}]),onClick:a[9]||(a[9]=e=>d.viewMode="list")}," List ",2)])]),"grid"===d.viewMode?((0,l.uX)(),(0,l.CE)("div",ve,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.cropImages,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"col"},[(0,l.bF)(n,{image:e,onViewDetails:o.viewImageDetails,onEditImage:o.editImage},null,8,["image","onViewDetails","onEditImage"])])))),128))])):((0,l.uX)(),(0,l.CE)("div",fe,[(0,l.Lk)("div",Le,[(0,l.Lk)("table",ye,[a[24]||(a[24]=(0,l.Lk)("thead",{class:"table-light"},[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Image"),(0,l.Lk)("th",null,"Sample ID"),(0,l.Lk)("th",null,"Description"),(0,l.Lk)("th",null,"Metadata"),(0,l.Lk)("th",null,"Actions")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.cropImages,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",Ce,[e.image_url?((0,l.uX)(),(0,l.CE)("img",{key:0,src:e.image_url,class:"thumbnail",alt:e.sample_id},null,8,Ie)):((0,l.uX)(),(0,l.CE)("div",Fe,"No Image"))]),(0,l.Lk)("td",null,(0,s.v_)(e.sample_id),1),(0,l.Lk)("td",null,(0,s.v_)(e.description||"N/A"),1),(0,l.Lk)("td",null,[e.metadata&&e.metadata.length>0?((0,l.uX)(),(0,l.CE)("div",we,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.metadata.slice(0,2),(e=>((0,l.uX)(),(0,l.CE)("span",{key:e.id,class:"badge bg-light text-dark me-1"},(0,s.v_)(e.label)+": "+(0,s.v_)(e.value),1)))),128)),e.metadata.length>2?((0,l.uX)(),(0,l.CE)("span",Me," +"+(0,s.v_)(e.metadata.length-2)+" more ",1)):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("span",Ee,"No metadata"))]),(0,l.Lk)("td",null,[(0,l.Lk)("div",_e,[(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a=>o.viewImageDetails(e)}," View ",8,Se),(0,l.Lk)("button",{class:"btn btn-outline-secondary",onClick:a=>o.editImage(e)}," Edit ",8,Ve)])])])))),128))])])])])),d.hasMoreImages?((0,l.uX)(),(0,l.CE)("div",Xe,[(0,l.Lk)("button",{class:"btn btn-outline-primary",onClick:a[10]||(a[10]=(...e)=>o.loadMoreImages&&o.loadMoreImages(...e)),disabled:d.loadingMore},[d.loadingMore?((0,l.uX)(),(0,l.CE)("span",Pe)):(0,l.Q3)("",!0),a[25]||(a[25]=(0,l.eW)(" Load More Images "))],8,xe)])):(0,l.Q3)("",!0)])),(0,l.Lk)("div",Ue,[(0,l.Lk)("div",$e,[(0,l.Lk)("div",Ae,[(0,l.Lk)("div",De,[(0,l.Lk)("h5",We,(0,s.v_)(d.selectedImage?d.selectedImage.sample_id:"Image Details"),1),a[26]||(a[26]=(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),d.selectedImage?((0,l.uX)(),(0,l.CE)("div",Te,[(0,l.Lk)("div",Ne,[(0,l.Lk)("div",Be,[(0,l.Lk)("div",Ge,[d.selectedImage.image_url?((0,l.uX)(),(0,l.CE)("img",{key:0,src:d.selectedImage.image_url,class:"img-fluid rounded",alt:d.selectedImage.sample_id},null,8,Qe)):((0,l.uX)(),(0,l.CE)("div",Re,"No Image Available"))]),(0,l.Lk)("div",Oe,[d.selectedImage.description?((0,l.uX)(),(0,l.CE)("p",je,(0,s.v_)(d.selectedImage.description),1)):(0,l.Q3)("",!0),(0,l.Lk)("p",qe," Uploaded: "+(0,s.v_)(o.formatDate(d.selectedImage.uploaded_at)),1),d.selectedImage.user_details?((0,l.uX)(),(0,l.CE)("p",Ke," By: "+(0,s.v_)(d.selectedImage.user_details.username),1)):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",Je,[a[28]||(a[28]=(0,l.Lk)("h6",null,"Metadata",-1)),d.selectedImage.metadata&&d.selectedImage.metadata.length>0?((0,l.uX)(),(0,l.CE)("div",ze,[(0,l.Lk)("table",He,[a[27]||(a[27]=(0,l.Lk)("thead",{class:"table-light"},[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Label"),(0,l.Lk)("th",null,"Value")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.selectedImage.metadata,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,s.v_)(e.label),1),(0,l.Lk)("td",null,(0,s.v_)(e.value),1)])))),128))])])])):((0,l.uX)(),(0,l.CE)("div",Ye," No metadata available for this image. "))])])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Ze,[a[29]||(a[29]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1)),d.selectedImage?((0,l.uX)(),(0,l.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:a[11]||(a[11]=e=>o.editImage(d.selectedImage))}," Edit Metadata ")):(0,l.Q3)("",!0)])])])],512)])}const aa={class:"card crop-image-card mb-4"},ta={class:"card-img-container"},la=["src","alt"],sa={key:1,class:"no-image"},ia={class:"card-body"},da={class:"card-title"},oa={key:0,class:"card-text"},na={key:1,class:"metadata-section mt-3"},ra={class:"metadata-tags"},ca={class:"mt-3 d-flex justify-content-between"};function ma(e,a,t,i,d,o){return(0,l.uX)(),(0,l.CE)("div",aa,[(0,l.Lk)("div",ta,[t.image.image_url?((0,l.uX)(),(0,l.CE)("img",{key:0,src:t.image.image_url,class:"card-img-top crop-image",alt:t.image.sample_id},null,8,la)):((0,l.uX)(),(0,l.CE)("div",sa,"No Image Available"))]),(0,l.Lk)("div",ia,[(0,l.Lk)("h5",da,(0,s.v_)(t.image.sample_id),1),t.image.description?((0,l.uX)(),(0,l.CE)("p",oa,(0,s.v_)(t.image.description),1)):(0,l.Q3)("",!0),t.image.metadata&&t.image.metadata.length>0?((0,l.uX)(),(0,l.CE)("div",na,[a[2]||(a[2]=(0,l.Lk)("h6",{class:"metadata-title"},"Metadata",-1)),(0,l.Lk)("div",ra,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.image.metadata,(e=>((0,l.uX)(),(0,l.CE)("span",{key:e.id,class:"badge bg-light text-dark me-2 mb-2"},(0,s.v_)(e.label)+": "+(0,s.v_)(e.value),1)))),128))])])):(0,l.Q3)("",!0),(0,l.Lk)("div",ca,[(0,l.Lk)("button",{onClick:a[0]||(a[0]=a=>e.$emit("view-details",t.image)),class:"btn btn-sm btn-outline-success"}," View Details "),t.showEdit?((0,l.uX)(),(0,l.CE)("button",{key:0,onClick:a[1]||(a[1]=a=>e.$emit("edit-image",t.image)),class:"btn btn-sm btn-outline-success"}," Edit ")):(0,l.Q3)("",!0)])])])}const ua={name:"CropImageCard",props:{image:{type:Object,required:!0},showEdit:{type:Boolean,default:!0}},emits:["view-details","edit-image"]},pa=(0,K.A)(ua,[["render",ma],["__scopeId","data-v-57303524"]]),ga=pa,ba={name:"CropImageGallery",components:{CropImageCard:ga},data(){return{showFilters:!0,filters:{csvFile:"",sampleId:"",metadataLabel:"",metadataValue:""},appliedFilters:{},viewMode:"grid",selectedImage:null,imageModal:null,loadingMore:!1,hasMoreImages:!1,currentPage:1}},computed:{...(0,E.L8)("crop",["getCsvFiles","getCropImages","getMetadataLabels","isLoading"]),loading(){return this.isLoading},csvFiles(){return this.getCsvFiles||[]},cropImages(){return this.getCropImages||[]},metadataLabels(){return this.getMetadataLabels||[]},hasActiveFilters(){return Object.values(this.filters).some((e=>""!==e))}},mounted(){this.fetchInitialData(),this.$nextTick((()=>{"undefined"!==typeof bootstrap&&(this.imageModal=new bootstrap.Modal(this.$refs.imageModal))}))},methods:{...(0,E.i0)("crop",["fetchCsvFiles","fetchCropImages","fetchMetadataLabels"]),async fetchInitialData(){await Promise.all([this.fetchCsvFiles(),this.fetchMetadataLabels(),this.fetchCropImages()])},toggleFilters(){this.showFilters=!this.showFilters},clearFilters(){this.filters={csvFile:"",sampleId:"",metadataLabel:"",metadataValue:""},this.applyFilters()},applyFilters(){this.appliedFilters={...this.filters},this.currentPage=1,this.fetchCropImages(this.filters)},async loadMoreImages(){this.loadingMore=!0,this.currentPage+=1;try{await new Promise((e=>setTimeout(e,500))),this.hasMoreImages=!1}catch(e){console.error("Error loading more images:",e)}finally{this.loadingMore=!1}},viewImageDetails(e){this.selectedImage=e,this.imageModal&&this.imageModal.show()},editImage(e){this.imageModal&&this.imageModal.hide(),this.$emit("edit-image",e)},formatDate(e){if(!e)return"Unknown";const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}},ha=(0,K.A)(ba,[["render",ea],["__scopeId","data-v-30447714"]]),ka=ha;var va=t(567);const fa={class:"modal fade",id:"namingGuideModal",tabindex:"-1","aria-labelledby":"namingGuideModalLabel","aria-hidden":"true"},La={class:"modal-dialog modal-lg"},ya={class:"modal-content"},Ca={class:"modal-body"},Ia={class:"tab-content p-3",id:"guideTabContent"},Fa={class:"tab-pane fade show active",id:"csv-content",role:"tabpanel","aria-labelledby":"csv-tab"},wa={class:"alert alert-info"},Ma=["href"],Ea={class:"modal-footer"},_a=["href"];function Sa(e,a,t,s,i,d){return(0,l.uX)(),(0,l.CE)("div",fa,[(0,l.Lk)("div",La,[(0,l.Lk)("div",ya,[a[13]||(a[13]=(0,l.Lk)("div",{class:"modal-header"},[(0,l.Lk)("h5",{class:"modal-title",id:"namingGuideModalLabel"},"Crop Image & CSV File Naming Guide"),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",Ca,[a[10]||(a[10]=(0,l.Fv)('<ul class="nav nav-tabs" id="guideTab" data-v-7b406a9e><li class="nav-item" data-v-7b406a9e><button class="nav-link active" id="csv-tab" data-bs-toggle="tab" data-bs-target="#csv-content" type="button" aria-controls="csv-content" data-v-7b406a9e>CSV Structure</button></li><li class="nav-item" data-v-7b406a9e><button class="nav-link" id="image-tab" data-bs-toggle="tab" data-bs-target="#image-content" type="button" aria-controls="image-content" data-v-7b406a9e>Image Naming</button></li><li class="nav-item" data-v-7b406a9e><button class="nav-link" id="workflow-tab" data-bs-toggle="tab" data-bs-target="#workflow-content" type="button" aria-controls="workflow-content" data-v-7b406a9e>Upload Workflow</button></li></ul>',1)),(0,l.Lk)("div",Ia,[(0,l.Lk)("div",Fa,[a[3]||(a[3]=(0,l.Lk)("h4",null,"CSV Metadata File Format",-1)),a[4]||(a[4]=(0,l.Lk)("p",null,"Your CSV metadata file should contain these columns:",-1)),a[5]||(a[5]=(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,[(0,l.Lk)("code",null,"sample_id"),(0,l.eW)(" (Required): Unique identifier for each crop sample (e.g., CROP_001)")]),(0,l.Lk)("li",null,"Additional fields (Optional): Add any relevant metadata like species, growth stage, health status, etc.")],-1)),a[6]||(a[6]=(0,l.Lk)("h5",null,"Example CSV Structure",-1)),a[7]||(a[7]=(0,l.Lk)("div",{class:"bg-light p-3 mb-3 rounded"},[(0,l.Lk)("pre",{class:"mb-0"},[(0,l.Lk)("code",null,"sample_id,species,cultivation_date,plant_age_days,growth_stage,health_status,description\nCROP_001,Lettuce,2025-01-15,45,Mature,Healthy,Romaine lettuce sample with normal growth pattern\nCROP_002,Lettuce,2025-01-15,45,Mature,Infected,Romaine lettuce sample showing early signs of fungal infection")])],-1)),(0,l.Lk)("div",wa,[a[0]||(a[0]=(0,l.Lk)("i",{class:"bi bi-info-circle-fill me-2"},null,-1)),a[1]||(a[1]=(0,l.eW)(" You can download our ")),(0,l.Lk)("a",{href:e.sampleCsvUrl,download:"sample_lettuce.csv",class:"alert-link"},"sample CSV template",8,Ma),a[2]||(a[2]=(0,l.eW)(" to get started. "))])]),a[8]||(a[8]=(0,l.Lk)("div",{class:"tab-pane fade",id:"image-content",role:"tabpanel","aria-labelledby":"image-tab"},[(0,l.Lk)("h4",null,"Image Naming Convention"),(0,l.Lk)("p",null,"When uploading crop images, follow these naming conventions:"),(0,l.Lk)("h5",null,"Basic Format"),(0,l.Lk)("p",null,[(0,l.Lk)("code",null,"{SAMPLE_ID}V{VERSION_NUMBER}")]),(0,l.Lk)("p",null,[(0,l.eW)("Example: "),(0,l.Lk)("code",null,"CROP_001V1.jpg"),(0,l.eW)(", "),(0,l.Lk)("code",null,"CROP_001V2.jpg"),(0,l.eW)(", "),(0,l.Lk)("code",null,"CROP_001V3.jpg")]),(0,l.Lk)("h5",null,"Sample ID"),(0,l.Lk)("p",null,[(0,l.eW)("Must match exactly with the "),(0,l.Lk)("code",null,"sample_id"),(0,l.eW)(" field in your CSV file")]),(0,l.Lk)("p",null,[(0,l.eW)("Example: If CSV has "),(0,l.Lk)("code",null,"CROP_001"),(0,l.eW)(", your image should start with "),(0,l.Lk)("code",null,"CROP_001")]),(0,l.Lk)("h5",null,"Version Number"),(0,l.Lk)("p",null,[(0,l.eW)("Append "),(0,l.Lk)("code",null,"V{number}"),(0,l.eW)(" to indicate different versions/angles of the same sample")]),(0,l.Lk)("p",null,[(0,l.eW)("Example: "),(0,l.Lk)("code",null,"CROP_001V1.jpg"),(0,l.eW)(" (first view), "),(0,l.Lk)("code",null,"CROP_001V2.jpg"),(0,l.eW)(" (second view)")]),(0,l.Lk)("div",{class:"alert alert-warning"},[(0,l.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"}),(0,l.eW)(" Image names that don't match any sample_id in the CSV file will be rejected. ")])],-1)),a[9]||(a[9]=(0,l.Lk)("div",{class:"tab-pane fade",id:"workflow-content",role:"tabpanel","aria-labelledby":"workflow-tab"},[(0,l.Lk)("h4",null,"Upload Workflow"),(0,l.Lk)("ol",null,[(0,l.Lk)("li",null,'First, upload your CSV metadata file through the "Upload CSV Mapping File" section'),(0,l.Lk)("li",null,'Process the CSV file by clicking "Process Now" after upload'),(0,l.Lk)("li",null,"Select the processed CSV file when uploading images"),(0,l.Lk)("li",null,"Upload your crop images - they will be automatically validated against the CSV sample IDs")]),(0,l.Lk)("h5",null,"Folder Structure (Recommended)"),(0,l.Lk)("p",null,"Organize your image files in folders by crop type or experiment:"),(0,l.Lk)("div",{class:"bg-light p-3 mb-3 rounded"},[(0,l.Lk)("pre",{class:"mb-0"},[(0,l.Lk)("code",null,"Lettuce_Experiment_2025/\n├── CROP_001V1.jpg\n├── CROP_001V2.jpg\n├── CROP_002V1.jpg\n├── CROP_002V2.jpg\n└── ...")])]),(0,l.Lk)("h5",null,"Best Practices"),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,"Keep sample IDs consistent across related experiments"),(0,l.Lk)("li",null,[(0,l.eW)("Use descriptive names for CSV files (e.g., "),(0,l.Lk)("code",null,"lettuce_growth_study_2025.csv"),(0,l.eW)(")")]),(0,l.Lk)("li",null,"Include sufficient metadata in your CSV to support later analysis"),(0,l.Lk)("li",null,"Take multiple viewpoints (versions) of the same sample when relevant")])],-1))])]),(0,l.Lk)("div",Ea,[(0,l.Lk)("a",{href:e.guideDocUrl,download:"crop_image_naming_guide.md",class:"btn btn-outline-primary me-auto"},a[11]||(a[11]=[(0,l.Lk)("i",{class:"bi bi-download me-1"},null,-1),(0,l.eW)(" Download Full Guide ")]),8,_a),a[12]||(a[12]=(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1))])])])])}const Va=(0,l.pM)({name:"NamingGuideModal",data(){return{sampleCsvUrl:"/sample_lettuce.csv",guideDocUrl:"/crop_image_naming_guide.md"}},mounted(){if("undefined"!==typeof window&&window.bootstrap){const e=document.getElementById("namingGuideModal");e&&(new window.bootstrap.Modal(e),this.$nextTick((()=>{const e=document.querySelectorAll("#guideTab button");e.forEach((e=>{e.addEventListener("click",(a=>{a.preventDefault();const t=e.getAttribute("data-bs-target");if(t){const a=document.querySelector(t),l=document.querySelectorAll(".tab-pane");l.forEach((e=>{e.classList.remove("show","active")})),a&&a.classList.add("show","active"),document.querySelectorAll("#guideTab button").forEach((e=>{e.classList.remove("active")})),e.classList.add("active")}}))}))})))}}}),Xa=(0,K.A)(Va,[["render",Sa],["__scopeId","data-v-7b406a9e"]]),xa=Xa,Pa={name:"CropImagesView",components:{BaseCard:_.A,BaseButton:S.A,CropImageUploader:z,CsvFileUploader:H.A,CropImageGallery:ka,MetadataEditor:va.A,NamingGuideModal:xa},data(){return{selectedImage:null,metadataModal:null}},computed:{...(0,E.L8)(["isLoading"]),loading(){return this.isLoading}},mounted(){this.fetchInitialData(),this.$nextTick((()=>{"undefined"!==typeof bootstrap&&(this.metadataModal=new bootstrap.Modal(this.$refs.metadataModal))}))},methods:{...(0,E.i0)("crop",["fetchCsvFiles","fetchCropImages"]),fetchInitialData(){this.fetchCsvFiles(),this.fetchCropImages()},refreshImages(){this.fetchCropImages()},refreshCsvFiles(){this.fetchCsvFiles()},handleCsvProcessed(){this.refreshCsvFiles(),this.refreshImages(),this.$toast?.success("CSV file processed successfully!")},editImage(e){this.selectedImage=e,this.metadataModal&&this.metadataModal.show()},handleMetadataUpdated(e){this.selectedImage&&(this.selectedImage.metadata=e,this.refreshImages())},scrollToUploader(){window.scrollTo({top:0,behavior:"smooth"})},showNamingGuide(){if("undefined"!==typeof bootstrap&&this.$refs.namingGuideModal){const e=document.getElementById("namingGuideModal");if(e){const a=new bootstrap.Modal(e);a.show()}}}}},Ua=(0,K.A)(Pa,[["render",M],["__scopeId","data-v-68dc2826"]]),$a=Ua},461:(e,a,t)=>{t.d(a,{A:()=>L});var l=t(641),s=t(751);const i={class:"csv-uploader card"},d={class:"card-body"},o={class:"mb-3"},n={class:"mb-3"},r={class:"d-grid gap-2"},c=["disabled"],m={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},u={key:0,class:"alert alert-success mt-3"},p=["disabled"],g={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"};function b(e,a,t,b,h,k){return(0,l.uX)(),(0,l.CE)("div",i,[a[10]||(a[10]=(0,l.Lk)("div",{class:"card-header bg-light"},[(0,l.Lk)("h5",{class:"mb-0"},"Upload CSV Mapping File")],-1)),(0,l.Lk)("div",d,[(0,l.Lk)("form",{onSubmit:a[2]||(a[2]=(0,s.D$)(((...e)=>k.uploadFile&&k.uploadFile(...e)),["prevent"]))},[(0,l.Lk)("div",o,[a[4]||(a[4]=(0,l.Lk)("label",{for:"fileTitle",class:"form-label"},"Title",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"fileTitle","onUpdate:modelValue":a[0]||(a[0]=e=>h.title=e),placeholder:"Enter a descriptive title",required:""},null,512),[[s.Jo,h.title]])]),(0,l.Lk)("div",n,[a[5]||(a[5]=(0,l.Lk)("label",{for:"csvFile",class:"form-label"},"CSV File",-1)),(0,l.Lk)("input",{type:"file",class:"form-control",id:"csvFile",onChange:a[1]||(a[1]=(...e)=>k.handleFileSelection&&k.handleFileSelection(...e)),accept:".csv",required:""},null,32),a[6]||(a[6]=(0,l.Lk)("div",{class:"form-text"},"Upload a CSV file with mapping information for crop images.",-1))]),(0,l.Lk)("div",r,[(0,l.Lk)("button",{type:"submit",class:"btn btn-success",disabled:!h.selectedFile||k.loading},[k.loading?((0,l.uX)(),(0,l.CE)("span",m)):(0,l.Q3)("",!0),a[7]||(a[7]=(0,l.eW)(" Upload CSV File "))],8,c)])],32),h.uploadSuccess?((0,l.uX)(),(0,l.CE)("div",u,[a[9]||(a[9]=(0,l.eW)(" CSV file uploaded successfully! ")),(0,l.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>k.processFile&&k.processFile(...e)),class:"btn btn-sm btn-outline-success ms-2",disabled:h.processing},[h.processing?((0,l.uX)(),(0,l.CE)("span",g)):(0,l.Q3)("",!0),a[8]||(a[8]=(0,l.eW)(" Process Now "))],8,p)])):(0,l.Q3)("",!0)])])}var h=t(278);const k={name:"CsvFileUploader",data(){return{title:"",selectedFile:null,uploadSuccess:!1,uploadedFileId:null,processing:!1}},computed:{...(0,h.L8)(["isLoading"]),loading(){return this.isLoading}},methods:{...(0,h.i0)("crop",["uploadCsvFile","processCsvFile"]),handleFileSelection(e){const a=e.target.files[0];a&&(this.selectedFile=a,this.title||(this.title=a.name.replace(/\.csv$/i,"")))},async uploadFile(){if(this.selectedFile)try{const e=new FormData;e.append("name",this.title),e.append("file",this.selectedFile);const a=await this.uploadCsvFile(e);this.uploadSuccess=!0,this.uploadedFileId=a.id,this.$emit("file-uploaded",a),this.$toast?.success("CSV file uploaded successfully!"),this.resetForm()}catch(e){console.error("Error uploading file:",e),this.$toast?.error("Failed to upload file. Please try again.")}},async processFile(){if(this.uploadedFileId){this.processing=!0;try{const e=await this.processCsvFile(this.uploadedFileId);this.$toast?.success(`CSV file processed successfully! ${e.created} records created.`),this.$emit("file-processed",{id:this.uploadedFileId,result:e})}catch(e){console.error("Error processing file:",e),this.$toast?.error("Failed to process file. Please try again.")}finally{this.processing=!1,this.uploadSuccess=!1,this.uploadedFileId=null}}},resetForm(){this.title="",this.selectedFile=null,this.uploadSuccess=!1;const e=document.getElementById("csvFile");e&&(e.value=""),this.$nextTick((()=>{const e=document.querySelector(".csv-uploader");e&&(e.style.opacity="0.99"),setTimeout((()=>{e&&(e.style.opacity="1")}),10)}))}}};var v=t(262);const f=(0,v.A)(k,[["render",b],["__scopeId","data-v-34355260"]]),L=f},567:(e,a,t)=>{t.d(a,{A:()=>V});var l=t(641),s=t(33),i=t(751);const d={class:"metadata-editor"},o={key:0,class:"text-center py-3"},n={key:1},r={key:0,class:"current-metadata mb-4"},c={class:"table table-sm table-hover"},m={key:1,class:"alert alert-info"},u={class:"mb-3"},p={class:"input-group"},g={id:"commonLabels"},b=["value"],h={class:"mb-3"},k={class:"d-flex justify-content-between"},v=["disabled"],f={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},L=["disabled"],y={class:"mt-4"},C={class:"mb-3"},I=["disabled"],F={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"};function w(e,a,t,w,M,E){return(0,l.uX)(),(0,l.CE)("div",d,[a[16]||(a[16]=(0,l.Lk)("h5",{class:"mb-3"},"Image Metadata",-1)),E.loading?((0,l.uX)(),(0,l.CE)("div",o,a[6]||(a[6]=[(0,l.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,l.Lk)("span",{class:"visually-hidden"},"Loading...")],-1)]))):((0,l.uX)(),(0,l.CE)("div",n,[M.metadata.length>0?((0,l.uX)(),(0,l.CE)("div",r,[a[8]||(a[8]=(0,l.Lk)("h6",null,"Current Metadata",-1)),(0,l.Lk)("table",c,[a[7]||(a[7]=(0,l.Lk)("thead",{class:"table-light"},[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"Label"),(0,l.Lk)("th",null,"Value")])],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(M.metadata,(e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("td",null,(0,s.v_)(e.label),1),(0,l.Lk)("td",null,(0,s.v_)(e.value),1)])))),128))])])])):((0,l.uX)(),(0,l.CE)("div",m," No metadata available for this image. ")),(0,l.Lk)("form",{onSubmit:a[3]||(a[3]=(0,i.D$)(((...e)=>E.addMetadata&&E.addMetadata(...e)),["prevent"]))},[a[12]||(a[12]=(0,l.Lk)("h6",null,"Add New Metadata",-1)),(0,l.Lk)("div",u,[a[9]||(a[9]=(0,l.Lk)("label",{for:"metadataLabel",class:"form-label"},"Label",-1)),(0,l.Lk)("div",p,[(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"metadataLabel","onUpdate:modelValue":a[0]||(a[0]=e=>M.newMetadata.label=e),list:"commonLabels",placeholder:"e.g., Crop Type, Growth Stage",required:""},null,512),[[i.Jo,M.newMetadata.label]]),(0,l.Lk)("datalist",g,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(E.metadataLabels,(e=>((0,l.uX)(),(0,l.CE)("option",{key:e,value:e},null,8,b)))),128))])])]),(0,l.Lk)("div",h,[a[10]||(a[10]=(0,l.Lk)("label",{for:"metadataValue",class:"form-label"},"Value",-1)),(0,l.bo)((0,l.Lk)("input",{type:"text",class:"form-control",id:"metadataValue","onUpdate:modelValue":a[1]||(a[1]=e=>M.newMetadata.value=e),placeholder:"e.g., Tomato, Flowering",required:""},null,512),[[i.Jo,M.newMetadata.value]])]),(0,l.Lk)("div",k,[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:M.addingMetadata},[M.addingMetadata?((0,l.uX)(),(0,l.CE)("span",f)):(0,l.Q3)("",!0),a[11]||(a[11]=(0,l.eW)(" Add Metadata "))],8,v),(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:a[2]||(a[2]=(...e)=>E.addMultiple&&E.addMultiple(...e)),disabled:!M.newMetadata.label||!M.newMetadata.value}," Add & Continue ",8,L)])],32),(0,l.Lk)("div",y,[a[14]||(a[14]=(0,l.Lk)("h6",null,"Batch Metadata Entry",-1)),a[15]||(a[15]=(0,l.Lk)("div",{class:"alert alert-light"},[(0,l.Lk)("small",null,[(0,l.eW)("Add multiple metadata items at once using format: "),(0,l.Lk)("code",null,"label:value"),(0,l.eW)(" (one per line)")])],-1)),(0,l.Lk)("div",C,[(0,l.bo)((0,l.Lk)("textarea",{class:"form-control",rows:"4","onUpdate:modelValue":a[4]||(a[4]=e=>M.batchMetadata=e),placeholder:"Crop Type:Tomato\\nPlant Age:45 days\\nHealth Status:Healthy"},null,512),[[i.Jo,M.batchMetadata]])]),(0,l.Lk)("button",{type:"button",class:"btn btn-outline-primary",onClick:a[5]||(a[5]=(...e)=>E.addBatchMetadata&&E.addBatchMetadata(...e)),disabled:!M.batchMetadata.trim()||M.addingMetadata},[M.addingMetadata?((0,l.uX)(),(0,l.CE)("span",F)):(0,l.Q3)("",!0),a[13]||(a[13]=(0,l.eW)(" Add Batch Metadata "))],8,I)])]))])}var M=t(278);const E={name:"MetadataEditor",props:{imageId:{type:[Number,String],required:!0},initialMetadata:{type:Array,default:()=>[]}},data(){return{metadata:[],newMetadata:{label:"",value:""},batchMetadata:"",addingMetadata:!1}},computed:{...(0,M.L8)("crop",["getMetadataLabels","isLoading"]),loading(){return this.isLoading},metadataLabels(){return this.getMetadataLabels||[]}},watch:{initialMetadata:{immediate:!0,handler(e){e&&Array.isArray(e)&&(this.metadata=[...e])}}},mounted(){this.fetchMetadataLabels()},methods:{...(0,M.i0)("crop",["fetchMetadataLabels","addMetadataToImage"]),resetForm(){this.newMetadata={label:"",value:""}},async addMetadata(){if(this.newMetadata.label&&this.newMetadata.value){this.addingMetadata=!0;try{const e=await this.addMetadataToImage({imageId:this.imageId,metadata:[this.newMetadata]});this.metadata=e.metadata||this.metadata,this.$emit("metadata-updated",this.metadata),this.$toast?.success("Metadata added successfully"),this.resetForm()}catch(e){console.error("Error adding metadata:",e),this.$toast?.error("Failed to add metadata. Please try again.")}finally{this.addingMetadata=!1}}},addMultiple(){if(!this.newMetadata.label||!this.newMetadata.value)return;const e={...this.newMetadata};this.metadata.push({id:`temp-${Date.now()}`,...e}),this.addMetadataToImage({imageId:this.imageId,metadata:[e]}).catch((e=>{console.error("Error adding metadata:",e),this.$toast?.error("Failed to add metadata. Please try again.")})),this.resetForm(),setTimeout((()=>{document.getElementById("metadataLabel")?.focus()}),0)},async addBatchMetadata(){if(!this.batchMetadata.trim())return;const e=this.parseBatchMetadata();if(0!==e.length){this.addingMetadata=!0;try{const a=await this.addMetadataToImage({imageId:this.imageId,metadata:e});this.metadata=a.metadata||this.metadata,this.$emit("metadata-updated",this.metadata),this.$toast?.success(`Added ${e.length} metadata items`),this.batchMetadata=""}catch(a){console.error("Error adding batch metadata:",a),this.$toast?.error("Failed to add metadata. Please try again.")}finally{this.addingMetadata=!1}}else this.$toast?.error("Invalid format. Please use label:value format, one per line.")},parseBatchMetadata(){const e=this.batchMetadata.split("\n"),a=[];for(const t of e){const e=t.trim();if(!e)continue;const l=e.indexOf(":");if(-1===l)continue;const s=e.substring(0,l).trim(),i=e.substring(l+1).trim();s&&i&&a.push({label:s,value:i})}return a}}};var _=t(262);const S=(0,_.A)(E,[["render",w],["__scopeId","data-v-768585b0"]]),V=S}}]);
//# sourceMappingURL=420.12429893.js.map