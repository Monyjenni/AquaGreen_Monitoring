"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[453],{453:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$});var r=a(641),i=a(33);const s={class:"visualization-view container py-4"},n={class:"mb-4"},l={class:"alert alert-info mb-4"},o={class:"d-flex align-items-center"},d={class:"d-flex flex-wrap gap-2 mb-2"},c={key:0,class:"text-center my-5"},u={key:1,class:"alert alert-danger"},h={key:2,class:"alert alert-info"},m={key:3,class:"row"},p={class:"card h-100 shadow-sm"},g={class:"card-header bg-success text-white d-flex justify-content-between align-items-center"},f=["title"],y={class:"badge bg-light text-dark"},b={class:"card-body"},k={class:"chart-preview"},v={class:"mt-3 text-center"};function _(e,t,a,_,C,L){const w=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",s,[(0,r.Lk)("div",n,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.go(-1)),class:"btn btn-sm btn-outline-secondary"},t[2]||(t[2]=[(0,r.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,r.eW)(" Back ")]))]),t[10]||(t[10]=(0,r.Lk)("h2",{class:"mb-4"},"Data Visualization",-1)),(0,r.Lk)("div",l,[(0,r.Lk)("div",o,[t[6]||(t[6]=(0,r.Lk)("i",{class:"bi bi-info-circle-fill me-2 fs-4"},null,-1)),(0,r.Lk)("div",null,[t[4]||(t[4]=(0,r.Lk)("strong",null,"Standardized Column Format",-1)),t[5]||(t[5]=(0,r.Lk)("p",{class:"mb-1"},"For best visualization results, your data should include these key columns:",-1)),(0,r.Lk)("div",d,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(C.standardRequiredColumns,(e=>((0,r.uX)(),(0,r.CE)("span",{key:e.id,class:"badge bg-primary"},(0,i.v_)(e.name),1)))),128))]),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>L.downloadTemplate&&L.downloadTemplate(...e)),class:"btn btn-sm btn-outline-primary"},t[3]||(t[3]=[(0,r.Lk)("i",{class:"bi bi-download me-1"},null,-1),(0,r.eW)(" Download Template ")]))])])]),e.loading?((0,r.uX)(),(0,r.CE)("div",c,t[7]||(t[7]=[(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,r.Lk)("p",{class:"mt-2"},"Loading your files...",-1)]))):e.error?((0,r.uX)(),(0,r.CE)("div",u,(0,i.v_)(e.error),1)):0===L.processedFiles.length?((0,r.uX)(),(0,r.CE)("div",h,t[8]||(t[8]=[(0,r.Lk)("div",{class:"text-center"},[(0,r.Lk)("i",{class:"bi bi-file-earmark-x fs-1 mb-2"}),(0,r.Lk)("p",null,"No processed files available. Process a file to see visualizations.")],-1)]))):((0,r.uX)(),(0,r.CE)("div",m,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.processedFiles,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"col-md-6 col-lg-4 mb-4"},[(0,r.Lk)("div",p,[(0,r.Lk)("div",g,[(0,r.Lk)("div",{class:"text-truncate",title:e.title},(0,i.v_)(e.title),9,f),(0,r.Lk)("span",y,(0,i.v_)(L.formatDate(e.processed_at)),1)]),(0,r.Lk)("div",b,[(0,r.Lk)("div",k,[(0,r.Lk)("canvas",{ref_for:!0,ref:`chart-${e.id}`},null,512)]),(0,r.Lk)("div",v,[(0,r.bF)(w,{to:`/files/${e.id}`,class:"btn btn-outline-success btn-sm"},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.Lk)("i",{class:"bi bi-graph-up me-1"},null,-1),(0,r.eW)(" View All Charts ")]))),_:2},1032,["to"])])])])])))),128))]))])}var C=a(278);const L=[{id:"plot_id",name:"Plot ID",type:"string",required:!0},{id:"crop",name:"Crop",type:"string",required:!0},{id:"year",name:"Year",type:"number",required:!0},{id:"plant",name:"Plant",type:"string",required:!0},{id:"variety",name:"Variety",type:"string",required:!0},{id:"area_hectares",name:"Area (ha)",type:"number",required:!1},{id:"production_tons",name:"Production (tons)",type:"number",required:!1},{id:"yield_tons_per_hectare",name:"Yield (tons/ha)",type:"number",required:!1},{id:"annual_rainfall_mm",name:"Annual Rainfall (mm)",type:"number",required:!1},{id:"avg_temperature_c",name:"Avg. Temperature (Â°C)",type:"number",required:!1},{id:"fertilizer_type_kg_ha",name:"Fertilizer Type/Rate (kg/ha)",type:"string",required:!1},{id:"pesticide_used_kg_ha",name:"Pesticide Used (kg/ha)",type:"number",required:!1},{id:"irrigation_type",name:"Irrigation Type",type:"string",required:!1},{id:"soil_ph",name:"Soil pH",type:"number",required:!1},{id:"organic_matter",name:"Organic Matter (%)",type:"number",required:!1},{id:"p_level_mg_kg",name:"P Level (mg/kg)",type:"number",required:!1},{id:"k_level_mg_kg",name:"K Level (mg/kg)",type:"number",required:!1},{id:"n_level_mg_kg",name:"N Level (mg/kg)",type:"number",required:!1},{id:"planting_date",name:"Planting Date",type:"date",required:!1},{id:"harvest_date",name:"Harvest Date",type:"date",required:!1}];const w={name:"DataVisualizationView",data(){return{chartInstances:{},chartRenderTimeout:null,standardRequiredColumns:L.filter((e=>e.required))}},computed:{...(0,C.aH)(["files","loading","error"]),processedFiles(){return this.files.filter((e=>e.processed))}},mounted(){this.fetchFiles(),this.chartRenderTimeout=setTimeout((()=>{this.renderCharts()}),500)},updated(){this.$nextTick((()=>{this.renderCharts()}))},beforeUnmount(){this.destroyAllCharts(),this.chartRenderTimeout&&clearTimeout(this.chartRenderTimeout)},methods:{...(0,C.i0)(["fetchFiles"]),downloadTemplate(){const e=L.map((e=>e.name)).join(","),t="data:text/csv;charset=utf-8,"+e,a=encodeURI(t),r=document.createElement("a");r.setAttribute("href",a),r.setAttribute("download","aquagreen_data_template.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),this.$toast?.success("Template downloaded successfully")},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()},destroyAllCharts(){Object.values(this.chartInstances).forEach((e=>{e&&"function"===typeof e.destroy&&e.destroy()})),this.chartInstances={}},renderCharts(){this.destroyAllCharts(),a.e(154).then(a.bind(a,154)).then((e=>{this.$refs&&this.processedFiles.forEach((t=>{const a=`chart-${t.id}`,r=this.$refs[a];if(!r||!r.length)return;const i=r[0];i&&0!==i.offsetWidth&&0!==i.offsetHeight&&this.$store.dispatch("fetchProcessedData",t.id).then((a=>{if(!a||!Array.isArray(a))return void(a&&a.error&&(this.renderEmptyChart(e.default,i,`File cannot be previewed: ${a.error}`),this.$toast?.warning(`File "${t.title}": ${a.error}, please check file content again.`)));if(a.length<=1)return this.renderEmptyChart(e.default,i,"Not enough rows"),void this.$toast?.warning(`File "${t.title}" doesn't have enough data for visualization, please check file content again.`);const r=a[0]?Object.keys(a[0]):[];if(r.length<=1)return this.renderEmptyChart(e.default,i,"Not enough columns"),void this.$toast?.warning(`File "${t.title}" doesn't have enough columns for visualization, please check file content again.`);const s=a.slice(0,5).map((e=>e[r[0]])),n=a.slice(0,5).map((e=>{const t=e[r[1]];return isNaN(t)?100*Math.random():parseFloat(t)}));try{this.chartInstances[t.id]=new e.default(i,{type:"bar",data:{labels:s.length?s:["Cat 1","Cat 2","Cat 3","Cat 4","Cat 5"],datasets:[{label:r[1]||"Sample Data",data:n.length?n:[100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random()],backgroundColor:"#198754"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Preview"}}}})}catch(l){console.error("Error creating chart:",l),this.renderEmptyChart(e.default,i,"Error creating chart")}})).catch((a=>{console.error(`Error fetching data for file ${t.id}:`,a),this.renderEmptyChart(e.default,i,"Cannot load data"),a.response?.data?.error&&this.$toast?.error(`Error with file "${t.title}": ${a.response.data.error}, please check file content again.`)}))}))})).catch((e=>{console.error("Failed to load Chart.js:",e)}))},renderEmptyChart(e,t,a){try{this.chartInstances[`empty-${Date.now()}`]=new e(t,{type:"bar",data:{labels:[""],datasets:[{data:[0],backgroundColor:"#f8f9fa"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{display:!1,beginAtZero:!0},x:{display:!1}},plugins:{legend:{display:!1},tooltip:{enabled:!1},title:{display:!0,text:a||"No data available",color:"#6c757d",font:{size:14}}}}})}catch(r){console.error("Error creating empty chart:",r)}}}};var q=a(262);const E=(0,q.A)(w,[["render",_],["__scopeId","data-v-cfca3ce8"]]),$=E}}]);
//# sourceMappingURL=453.2b869633.js.map