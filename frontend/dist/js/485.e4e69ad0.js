"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[485],{485:(e,i,t)=>{t.r(i),t.d(i,{default:()=>T});var s=t(641),r=t(33),a=t(751);const o={class:"otp-verification-container"},n={class:"card login-card"},c={class:"card-body"},l={class:"d-flex align-items-center mb-4"},u={key:0,class:"form-container"},d={class:"form-group"},h={class:"otp-input-container"},f={key:0,class:"invalid-feedback"},p={key:0,class:"timer-container"},m={class:"timer"},g={key:1,class:"timer-container"},v={class:"form-actions"},k=["disabled"],y=["disabled"],b={key:1,class:"success-message"},L={key:2,class:"error-message"},V={class:"form-actions mt-3"};function E(e,i,t,E,R,C){return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",n,[(0,s.Lk)("div",c,[(0,s.Lk)("div",l,[(0,s.Lk)("button",{onClick:i[0]||(i[0]=(...i)=>e.goBack&&e.goBack(...i)),class:"btn btn-icon me-3","aria-label":"Back"},i[8]||(i[8]=[(0,s.Lk)("i",{class:"bi bi-arrow-left-circle-fill text-success fs-4"},null,-1)])),i[9]||(i[9]=(0,s.Lk)("h2",{class:"m-0"},[(0,s.Lk)("span",{class:"brand-name"},[(0,s.eW)("Aqua"),(0,s.Lk)("span",{class:"text-success"},"Green")])],-1))]),i[18]||(i[18]=(0,s.Lk)("h3",{class:"text-center mb-4"},"Verify Your Identity",-1)),e.verificationSuccess||e.verificationError?e.verificationSuccess?((0,s.uX)(),(0,s.CE)("div",b,[i[13]||(i[13]=(0,s.Lk)("i",{class:"fas fa-check-circle success-icon"},null,-1)),i[14]||(i[14]=(0,s.Lk)("h3",null,"Verification Successful!",-1)),i[15]||(i[15]=(0,s.Lk)("p",null,"Your identity has been verified successfully.",-1)),(0,s.Lk)("button",{onClick:i[5]||(i[5]=(...i)=>e.continueProcess&&e.continueProcess(...i)),class:"btn btn-success w-100 mt-3"}," Continue ")])):((0,s.uX)(),(0,s.CE)("div",L,[i[16]||(i[16]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle error-icon"},null,-1)),i[17]||(i[17]=(0,s.Lk)("h3",null,"Verification Failed",-1)),(0,s.Lk)("p",null,(0,r.v_)(e.verificationErrorMessage),1),(0,s.Lk)("div",V,[(0,s.Lk)("button",{onClick:i[6]||(i[6]=(...i)=>e.resetVerification&&e.resetVerification(...i)),class:"btn btn-outline-secondary w-100 mb-3"}," Try Again "),(0,s.Lk)("button",{onClick:i[7]||(i[7]=(...i)=>e.goToLogin&&e.goToLogin(...i)),class:"btn btn-success w-100"}," Return to Login ")])])):((0,s.uX)(),(0,s.CE)("div",u,[i[12]||(i[12]=(0,s.Lk)("p",{class:"instruction"},"We've sent a verification code to your email. Please enter the 6-digit code below to verify your identity.",-1)),(0,s.Lk)("div",d,[i[10]||(i[10]=(0,s.Lk)("label",{for:"otp"},"Verification Code",-1)),(0,s.Lk)("div",h,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"otp","onUpdate:modelValue":i[1]||(i[1]=i=>e.otp=i),class:(0,r.C4)(["form-control otp-input",{"is-invalid":e.otpError}]),placeholder:"Enter 6-digit code",onInput:i[2]||(i[2]=(...i)=>e.validateOtpInput&&e.validateOtpInput(...i)),maxlength:"6"},null,34),[[a.Jo,e.otp]])]),e.otpError?((0,s.uX)(),(0,s.CE)("div",f,(0,r.v_)(e.otpError),1)):(0,s.Q3)("",!0)]),e.timeRemaining>0?((0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("span",m,"Code expires in: "+(0,r.v_)(e.formatTime(e.timeRemaining)),1)])):((0,s.uX)(),(0,s.CE)("div",g,i[11]||(i[11]=[(0,s.Lk)("span",{class:"expired"},"Code expired",-1)]))),(0,s.Lk)("div",v,[(0,s.Lk)("button",{onClick:i[3]||(i[3]=(...i)=>e.resendOtp&&e.resendOtp(...i)),class:"btn btn-outline-secondary w-100 mb-3",disabled:e.isResending||e.timeRemaining>0},(0,r.v_)(e.isResending?"Sending...":"Resend Code"),9,k),(0,s.Lk)("button",{onClick:i[4]||(i[4]=(...i)=>e.verifyOtp&&e.verifyOtp(...i)),class:"btn btn-success w-100",disabled:!e.isValidOtp||e.isVerifying},(0,r.v_)(e.isVerifying?"Verifying...":"Verify"),9,y)])]))])])])}var R=t(335);const C=(0,s.pM)({name:"OtpVerificationView",props:{email:{type:String,default:""},returnPath:{type:String,default:"/"},isRegistration:{type:Boolean,default:!1},onSuccess:{type:Function,default:null}},data(){return{otp:"",otpError:"",isVerifying:!1,isResending:!1,verificationSuccess:!1,verificationError:!1,verificationErrorMessage:"",timeRemaining:600,timer:null,emailValue:this.email||this.$route.query.email||"",returnPathValue:this.returnPath||this.$route.query.returnPath||"/",isRegistrationValue:"true"===this.$route.query.isRegistration}},computed:{isValidOtp(){return 6===this.otp.length&&/^\d+$/.test(this.otp)}},created(){const e=this.$route.query;e.email&&(this.emailValue=e.email),void 0!==e.isRegistration&&(this.isRegistrationValue="true"===e.isRegistration),e.returnPath&&(this.returnPathValue=e.returnPath),this.startTimer()},beforeUnmount(){this.clearTimer()},methods:{startTimer(){this.clearTimer(),this.timer=setInterval((()=>{this.timeRemaining>0?this.timeRemaining--:this.clearTimer()}),1e3)},clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)},formatTime(e){const i=Math.floor(e/60),t=e%60;return`${i}:${t.toString().padStart(2,"0")}`},validateOtpInput(){this.otp=this.otp.replace(/\D/g,""),this.otpError=""},goToLogin(){this.$router.push("/login")},goBack(){this.$router.back()},resetVerification(){this.otp="",this.otpError="",this.verificationError=!1,this.verificationErrorMessage=""},async resendOtp(){this.isResending=!0;try{await R.A.post("auth/password-reset-otp/request-code/",{email:this.email}),this.timeRemaining=600,this.startTimer(),this.$emit("otp-resent"),this.$toast.success("Verification code resent successfully")}catch(e){console.error("Failed to resend OTP:",e),this.$toast.error("Failed to resend verification code")}finally{this.isResending=!1}},async verifyOtp(){if(this.isValidOtp){this.isVerifying=!0;try{const e=await R.A.post("auth/password-reset-otp/verify-code/",{email:this.emailValue,code:this.otp,registration:this.isRegistrationValue});e.data.verified?(this.verificationSuccess=!0,this.clearTimer(),this.isRegistration&&e.data.access&&e.data.refresh&&e.data.user&&(localStorage.setItem("token",e.data.access),localStorage.setItem("refreshToken",e.data.refresh),localStorage.setItem("user",JSON.stringify(e.data.user)),R.A.defaults.headers.common["Authorization"]=`Bearer ${e.data.access}`),"function"===typeof this.onSuccess&&this.onSuccess()):(this.verificationError=!0,this.verificationErrorMessage="Invalid verification code. Please try again.")}catch(e){console.error("OTP verification failed:",e),this.verificationError=!0,e.response&&e.response.data&&e.response.data.error?this.verificationErrorMessage=e.response.data.error:this.verificationErrorMessage="Invalid or expired verification code. Please try again."}finally{this.isVerifying=!1}}else this.otpError="Please enter a valid 6-digit code"},continueProcess(){this.isRegistrationValue?this.$router.push("/login"):this.returnPathValue?this.$router.push(this.returnPathValue):this.$router.push("/login")}}});var P=t(262);const S=(0,P.A)(C,[["render",E],["__scopeId","data-v-47632afc"]]),T=S}}]);
//# sourceMappingURL=485.e4e69ad0.js.map