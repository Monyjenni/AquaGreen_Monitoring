"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[601],{567:(a,e,t)=>{t.d(e,{A:()=>A});var d=t(641),l=t(33),i=t(751);const s={class:"metadata-editor"},r={key:0,class:"text-center py-3"},o={key:1},n={key:0,class:"current-metadata mb-4"},m={class:"table table-sm table-hover"},c={key:1,class:"alert alert-info"},u={class:"mb-3"},h={class:"input-group"},g={id:"commonLabels"},b=["value"],k={class:"mb-3"},p={class:"d-flex justify-content-between"},L=["disabled"],v={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},f=["disabled"],y={class:"mt-4"},M={class:"mb-3"},C=["disabled"],I={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"};function w(a,e,t,w,E,_){return(0,d.uX)(),(0,d.CE)("div",s,[e[16]||(e[16]=(0,d.Lk)("h5",{class:"mb-3"},"Image Metadata",-1)),_.loading?((0,d.uX)(),(0,d.CE)("div",r,e[6]||(e[6]=[(0,d.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,d.Lk)("span",{class:"visually-hidden"},"Loading...")],-1)]))):((0,d.uX)(),(0,d.CE)("div",o,[E.metadata.length>0?((0,d.uX)(),(0,d.CE)("div",n,[e[8]||(e[8]=(0,d.Lk)("h6",null,"Current Metadata",-1)),(0,d.Lk)("table",m,[e[7]||(e[7]=(0,d.Lk)("thead",{class:"table-light"},[(0,d.Lk)("tr",null,[(0,d.Lk)("th",null,"Label"),(0,d.Lk)("th",null,"Value")])],-1)),(0,d.Lk)("tbody",null,[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(E.metadata,(a=>((0,d.uX)(),(0,d.CE)("tr",{key:a.id},[(0,d.Lk)("td",null,(0,l.v_)(a.label),1),(0,d.Lk)("td",null,(0,l.v_)(a.value),1)])))),128))])])])):((0,d.uX)(),(0,d.CE)("div",c," No metadata available for this image. ")),(0,d.Lk)("form",{onSubmit:e[3]||(e[3]=(0,i.D$)(((...a)=>_.addMetadata&&_.addMetadata(...a)),["prevent"]))},[e[12]||(e[12]=(0,d.Lk)("h6",null,"Add New Metadata",-1)),(0,d.Lk)("div",u,[e[9]||(e[9]=(0,d.Lk)("label",{for:"metadataLabel",class:"form-label"},"Label",-1)),(0,d.Lk)("div",h,[(0,d.bo)((0,d.Lk)("input",{type:"text",class:"form-control",id:"metadataLabel","onUpdate:modelValue":e[0]||(e[0]=a=>E.newMetadata.label=a),list:"commonLabels",placeholder:"e.g., Crop Type, Growth Stage",required:""},null,512),[[i.Jo,E.newMetadata.label]]),(0,d.Lk)("datalist",g,[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(_.metadataLabels,(a=>((0,d.uX)(),(0,d.CE)("option",{key:a,value:a},null,8,b)))),128))])])]),(0,d.Lk)("div",k,[e[10]||(e[10]=(0,d.Lk)("label",{for:"metadataValue",class:"form-label"},"Value",-1)),(0,d.bo)((0,d.Lk)("input",{type:"text",class:"form-control",id:"metadataValue","onUpdate:modelValue":e[1]||(e[1]=a=>E.newMetadata.value=a),placeholder:"e.g., Tomato, Flowering",required:""},null,512),[[i.Jo,E.newMetadata.value]])]),(0,d.Lk)("div",p,[(0,d.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:E.addingMetadata},[E.addingMetadata?((0,d.uX)(),(0,d.CE)("span",v)):(0,d.Q3)("",!0),e[11]||(e[11]=(0,d.eW)(" Add Metadata "))],8,L),(0,d.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[2]||(e[2]=(...a)=>_.addMultiple&&_.addMultiple(...a)),disabled:!E.newMetadata.label||!E.newMetadata.value}," Add & Continue ",8,f)])],32),(0,d.Lk)("div",y,[e[14]||(e[14]=(0,d.Lk)("h6",null,"Batch Metadata Entry",-1)),e[15]||(e[15]=(0,d.Lk)("div",{class:"alert alert-light"},[(0,d.Lk)("small",null,[(0,d.eW)("Add multiple metadata items at once using format: "),(0,d.Lk)("code",null,"label:value"),(0,d.eW)(" (one per line)")])],-1)),(0,d.Lk)("div",M,[(0,d.bo)((0,d.Lk)("textarea",{class:"form-control",rows:"4","onUpdate:modelValue":e[4]||(e[4]=a=>E.batchMetadata=a),placeholder:"Crop Type:Tomato\\nPlant Age:45 days\\nHealth Status:Healthy"},null,512),[[i.Jo,E.batchMetadata]])]),(0,d.Lk)("button",{type:"button",class:"btn btn-outline-primary",onClick:e[5]||(e[5]=(...a)=>_.addBatchMetadata&&_.addBatchMetadata(...a)),disabled:!E.batchMetadata.trim()||E.addingMetadata},[E.addingMetadata?((0,d.uX)(),(0,d.CE)("span",I)):(0,d.Q3)("",!0),e[13]||(e[13]=(0,d.eW)(" Add Batch Metadata "))],8,C)])]))])}var E=t(278);const _={name:"MetadataEditor",props:{imageId:{type:[Number,String],required:!0},initialMetadata:{type:Array,default:()=>[]}},data(){return{metadata:[],newMetadata:{label:"",value:""},batchMetadata:"",addingMetadata:!1}},computed:{...(0,E.L8)("crop",["getMetadataLabels","isLoading"]),loading(){return this.isLoading},metadataLabels(){return this.getMetadataLabels||[]}},watch:{initialMetadata:{immediate:!0,handler(a){a&&Array.isArray(a)&&(this.metadata=[...a])}}},mounted(){this.fetchMetadataLabels()},methods:{...(0,E.i0)("crop",["fetchMetadataLabels","addMetadataToImage"]),resetForm(){this.newMetadata={label:"",value:""}},async addMetadata(){if(this.newMetadata.label&&this.newMetadata.value){this.addingMetadata=!0;try{const a=await this.addMetadataToImage({imageId:this.imageId,metadata:[this.newMetadata]});this.metadata=a.metadata||this.metadata,this.$emit("metadata-updated",this.metadata),this.$toast?.success("Metadata added successfully"),this.resetForm()}catch(a){console.error("Error adding metadata:",a),this.$toast?.error("Failed to add metadata. Please try again.")}finally{this.addingMetadata=!1}}},addMultiple(){if(!this.newMetadata.label||!this.newMetadata.value)return;const a={...this.newMetadata};this.metadata.push({id:`temp-${Date.now()}`,...a}),this.addMetadataToImage({imageId:this.imageId,metadata:[a]}).catch((a=>{console.error("Error adding metadata:",a),this.$toast?.error("Failed to add metadata. Please try again.")})),this.resetForm(),setTimeout((()=>{document.getElementById("metadataLabel")?.focus()}),0)},async addBatchMetadata(){if(!this.batchMetadata.trim())return;const a=this.parseBatchMetadata();if(0!==a.length){this.addingMetadata=!0;try{const e=await this.addMetadataToImage({imageId:this.imageId,metadata:a});this.metadata=e.metadata||this.metadata,this.$emit("metadata-updated",this.metadata),this.$toast?.success(`Added ${a.length} metadata items`),this.batchMetadata=""}catch(e){console.error("Error adding batch metadata:",e),this.$toast?.error("Failed to add metadata. Please try again.")}finally{this.addingMetadata=!1}}else this.$toast?.error("Invalid format. Please use label:value format, one per line.")},parseBatchMetadata(){const a=this.batchMetadata.split("\n"),e=[];for(const t of a){const a=t.trim();if(!a)continue;const d=a.indexOf(":");if(-1===d)continue;const l=a.substring(0,d).trim(),i=a.substring(d+1).trim();l&&i&&e.push({label:l,value:i})}return e}}};var X=t(262);const F=(0,X.A)(_,[["render",w],["__scopeId","data-v-768585b0"]]),A=F},601:(a,e,t)=>{t.r(e),t.d(e,{default:()=>K});var d=t(641),l=t(33);const i={class:"crop-image-detail-view"},s={class:"d-flex justify-content-between align-items-center mb-4"},r={key:0,class:"text-center py-5"},o={key:1,class:"text-center py-5 bg-light rounded"},n={key:2,class:"row"},m={class:"col-md-5 mb-4"},c={class:"image-container mb-3"},u=["src","alt"],h={key:1,class:"no-image"},g={class:"image-info"},b={key:0,class:"mb-3"},k={class:"table table-sm"},p={key:0},L={key:1},v={class:"d-grid gap-2 mt-3"},f={class:"col-md-7"},y={key:0,class:"alert alert-info"},M={key:1},C={class:"table table-striped table-hover"},I={key:0,class:"alert alert-info"},w={key:1,class:"related-images row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3"},E=["onClick"],_=["src","alt"],X={key:1,class:"no-thumb"},F={class:"sample-id"},A={class:"modal fade",id:"metadataEditorModal",tabindex:"-1","aria-labelledby":"metadataEditorModalLabel","aria-hidden":"true",ref:"metadataModal"},$={class:"modal-dialog modal-lg"},x={class:"modal-content"},B={class:"modal-header"},T={class:"modal-title",id:"metadataEditorModalLabel"},W={class:"modal-body"},D={class:"modal-footer"};function V(a,e,t,V,U,N){const S=(0,d.g2)("base-button"),Q=(0,d.g2)("base-card"),R=(0,d.g2)("metadata-editor");return(0,d.uX)(),(0,d.CE)("div",i,[(0,d.Lk)("div",s,[e[3]||(e[3]=(0,d.Lk)("h2",{class:"mb-0"},"Crop Image Details",-1)),(0,d.Lk)("div",null,[(0,d.bF)(S,{variant:"outline-secondary",onClick:e[0]||(e[0]=e=>a.$router.push({name:"crop-images"})),size:"sm"},{default:(0,d.k6)((()=>e[2]||(e[2]=[(0,d.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,d.eW)(" Back to Gallery ")]))),_:1})])]),N.loading?((0,d.uX)(),(0,d.CE)("div",r,e[4]||(e[4]=[(0,d.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,d.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,d.Lk)("p",{class:"mt-2 text-muted"},"Loading image details...",-1)]))):N.image?((0,d.uX)(),(0,d.CE)("div",n,[(0,d.Lk)("div",m,[(0,d.bF)(Q,null,{default:(0,d.k6)((()=>[(0,d.Lk)("div",c,[N.image.image_url?((0,d.uX)(),(0,d.CE)("img",{key:0,src:N.image.image_url,class:"img-fluid rounded",alt:N.image.sample_id},null,8,u)):((0,d.uX)(),(0,d.CE)("div",h,"No Image Available"))]),(0,d.Lk)("div",g,[(0,d.Lk)("h4",null,(0,l.v_)(N.image.sample_id),1),N.image.description?((0,d.uX)(),(0,d.CE)("p",b,(0,l.v_)(N.image.description),1)):(0,d.Q3)("",!0),(0,d.Lk)("table",k,[(0,d.Lk)("tbody",null,[(0,d.Lk)("tr",null,[e[9]||(e[9]=(0,d.Lk)("th",{scope:"row",style:{width:"40%"}},"Uploaded",-1)),(0,d.Lk)("td",null,(0,l.v_)(N.formatDate(N.image.uploaded_at)),1)]),N.image.user_details?((0,d.uX)(),(0,d.CE)("tr",p,[e[10]||(e[10]=(0,d.Lk)("th",{scope:"row"},"Uploaded By",-1)),(0,d.Lk)("td",null,(0,l.v_)(N.image.user_details.username),1)])):(0,d.Q3)("",!0),N.csvFile?((0,d.uX)(),(0,d.CE)("tr",L,[e[11]||(e[11]=(0,d.Lk)("th",{scope:"row"},"CSV File",-1)),(0,d.Lk)("td",null,(0,l.v_)(N.csvFile.title),1)])):(0,d.Q3)("",!0)])]),(0,d.Lk)("div",v,[(0,d.bF)(S,{variant:"primary",onClick:N.editMetadata},{default:(0,d.k6)((()=>e[12]||(e[12]=[(0,d.Lk)("i",{class:"bi bi-pencil me-1"},null,-1),(0,d.eW)(" Edit Metadata ")]))),_:1},8,["onClick"])])])])),_:1})]),(0,d.Lk)("div",f,[(0,d.bF)(Q,{title:"Metadata"},{footer:(0,d.k6)((()=>[(0,d.bF)(S,{variant:"outline-primary",onClick:N.editMetadata,class:"float-end"},{default:(0,d.k6)((()=>e[15]||(e[15]=[(0,d.Lk)("i",{class:"bi bi-plus me-1"},null,-1),(0,d.eW)(" Add Metadata ")]))),_:1},8,["onClick"])])),default:(0,d.k6)((()=>[N.image.metadata&&0!==N.image.metadata.length?((0,d.uX)(),(0,d.CE)("div",M,[(0,d.Lk)("table",C,[e[14]||(e[14]=(0,d.Lk)("thead",null,[(0,d.Lk)("tr",null,[(0,d.Lk)("th",null,"Label"),(0,d.Lk)("th",null,"Value")])],-1)),(0,d.Lk)("tbody",null,[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(N.image.metadata,(a=>((0,d.uX)(),(0,d.CE)("tr",{key:a.id},[(0,d.Lk)("td",null,(0,l.v_)(a.label),1),(0,d.Lk)("td",null,(0,l.v_)(a.value),1)])))),128))])])])):((0,d.uX)(),(0,d.CE)("div",y,e[13]||(e[13]=[(0,d.Lk)("i",{class:"bi bi-info-circle me-2"},null,-1),(0,d.eW)(" No metadata available for this image. ")])))])),_:1}),(0,d.bF)(Q,{title:"Related Images",class:"mt-4"},{default:(0,d.k6)((()=>[0===U.relatedImages.length?((0,d.uX)(),(0,d.CE)("div",I,e[16]||(e[16]=[(0,d.Lk)("i",{class:"bi bi-info-circle me-2"},null,-1),(0,d.eW)(" No other images from the same CSV file. ")]))):((0,d.uX)(),(0,d.CE)("div",w,[((0,d.uX)(!0),(0,d.CE)(d.FK,null,(0,d.pI)(U.relatedImages,(a=>((0,d.uX)(),(0,d.CE)("div",{key:a.id,class:"col"},[(0,d.Lk)("div",{class:(0,l.C4)(["related-image-card",{active:a.id===N.image.id}]),onClick:e=>N.viewRelatedImage(a.id)},[a.image_url?((0,d.uX)(),(0,d.CE)("img",{key:0,src:a.image_url,class:"img-thumbnail",alt:a.sample_id},null,8,_)):((0,d.uX)(),(0,d.CE)("div",X,"No Image")),(0,d.Lk)("div",F,(0,l.v_)(a.sample_id),1)],10,E)])))),128))]))])),_:1})])])):((0,d.uX)(),(0,d.CE)("div",o,[e[6]||(e[6]=(0,d.Lk)("div",{class:"display-1 text-muted mb-3"},[(0,d.Lk)("i",{class:"bi bi-image"})],-1)),e[7]||(e[7]=(0,d.Lk)("h4",{class:"text-muted"},"Image Not Found",-1)),e[8]||(e[8]=(0,d.Lk)("p",{class:"text-muted"},"The requested image could not be found or has been deleted.",-1)),(0,d.bF)(S,{variant:"primary",onClick:e[1]||(e[1]=e=>a.$router.push({name:"crop-images"}))},{default:(0,d.k6)((()=>e[5]||(e[5]=[(0,d.eW)(" Return to Gallery ")]))),_:1})])),(0,d.Lk)("div",A,[(0,d.Lk)("div",$,[(0,d.Lk)("div",x,[(0,d.Lk)("div",B,[(0,d.Lk)("h5",T," Edit Metadata: "+(0,l.v_)(N.image?N.image.sample_id:""),1),e[17]||(e[17]=(0,d.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),(0,d.Lk)("div",W,[N.image?((0,d.uX)(),(0,d.Wv)(R,{key:0,"image-id":N.image.id,"initial-metadata":N.image.metadata,onMetadataUpdated:N.handleMetadataUpdated},null,8,["image-id","initial-metadata","onMetadataUpdated"])):(0,d.Q3)("",!0)]),(0,d.Lk)("div",D,[(0,d.bF)(S,{variant:"secondary","data-bs-dismiss":"modal"},{default:(0,d.k6)((()=>e[18]||(e[18]=[(0,d.eW)("Close")]))),_:1})])])])],512)])}var U=t(278),N=t(228),S=t(753),Q=t(567);const R={name:"CropImageDetailView",components:{BaseCard:N.A,BaseButton:S.A,MetadataEditor:Q.A},data(){return{imageId:null,metadataModal:null,relatedImages:[]}},computed:{...(0,U.L8)("crop",["getCropImages","getCurrentCropImage","getCsvFiles","isLoading"]),image(){return this.getCurrentCropImage},loading(){return this.isLoading},csvFile(){return this.image&&this.image.csv_file?this.getCsvFiles.find((a=>a.id===this.image.csv_file)):null}},watch:{"$route.params.id":{immediate:!0,handler(a){a&&(this.imageId=a,this.fetchImageDetails())}}},mounted(){this.fetchCsvFiles(),this.$nextTick((()=>{"undefined"!==typeof bootstrap&&(this.metadataModal=new bootstrap.Modal(this.$refs.metadataModal))}))},methods:{...(0,U.i0)("crop",["fetchCropImage","fetchCropImages","fetchCsvFiles"]),async fetchImageDetails(){try{await this.fetchCropImage(this.imageId),this.image&&this.image.csv_file&&this.fetchRelatedImages()}catch(a){console.error("Error fetching image details:",a),this.$toast?.error("Failed to load image details")}},async fetchRelatedImages(){try{await this.fetchCropImages({csvFile:this.image.csv_file}),this.relatedImages=this.getCropImages.filter((a=>a.id!==this.image.id)).slice(0,12)}catch(a){console.error("Error fetching related images:",a)}},editMetadata(){this.metadataModal&&this.metadataModal.show()},handleMetadataUpdated(){this.fetchImageDetails()},viewRelatedImage(a){this.$router.push({name:"crop-image-detail",params:{id:a}})},formatDate(a){if(!a)return"Unknown";const e=new Date(a);return e.toLocaleDateString()+" "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}};var P=t(262);const q=(0,P.A)(R,[["render",V],["__scopeId","data-v-24e08ca8"]]),K=q}}]);
//# sourceMappingURL=601.a5fd658c.js.map