"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[648],{648:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var r=a(641),s=a(33);const i={class:"visualization-view container py-4"},n={class:"mb-4"},o={key:0,class:"text-center my-5"},l={key:1,class:"alert alert-danger"},c={key:2,class:"alert alert-info"},d={key:3,class:"row"},h={class:"card h-100 shadow-sm"},u={class:"card-header bg-success text-white d-flex justify-content-between align-items-center"},f=["title"],p={class:"badge bg-light text-dark"},m={class:"card-body"},g={class:"chart-preview"},b={class:"mt-3 text-center"};function k(e,t,a,k,v,y){const C=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.Lk)("div",n,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$router.go(-1)),class:"btn btn-sm btn-outline-secondary"},t[1]||(t[1]=[(0,r.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,r.eW)(" Back ")]))]),t[5]||(t[5]=(0,r.Lk)("h2",{class:"mb-4"},"Data Visualization",-1)),e.loading?((0,r.uX)(),(0,r.CE)("div",o,t[2]||(t[2]=[(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,r.Lk)("p",{class:"mt-2"},"Loading your files...",-1)]))):e.error?((0,r.uX)(),(0,r.CE)("div",l,(0,s.v_)(e.error),1)):0===y.processedFiles.length?((0,r.uX)(),(0,r.CE)("div",c,t[3]||(t[3]=[(0,r.Lk)("div",{class:"text-center"},[(0,r.Lk)("i",{class:"bi bi-file-earmark-x fs-1 mb-2"}),(0,r.Lk)("p",null,"No processed files available. Process a file to see visualizations.")],-1)]))):((0,r.uX)(),(0,r.CE)("div",d,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.processedFiles,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"col-md-6 col-lg-4 mb-4"},[(0,r.Lk)("div",h,[(0,r.Lk)("div",u,[(0,r.Lk)("div",{class:"text-truncate",title:e.title},(0,s.v_)(e.title),9,f),(0,r.Lk)("span",p,(0,s.v_)(y.formatDate(e.processed_at)),1)]),(0,r.Lk)("div",m,[(0,r.Lk)("div",g,[(0,r.Lk)("canvas",{ref_for:!0,ref:`chart-${e.id}`},null,512)]),(0,r.Lk)("div",b,[(0,r.bF)(C,{to:`/files/${e.id}`,class:"btn btn-outline-success btn-sm"},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.Lk)("i",{class:"bi bi-graph-up me-1"},null,-1),(0,r.eW)(" View All Charts ")]))),_:2},1032,["to"])])])])])))),128))]))])}var v=a(278);const y={name:"DataVisualizationView",data(){return{chartInstances:{},chartRenderTimeout:null}},computed:{...(0,v.aH)(["files","loading","error"]),processedFiles(){return this.files.filter((e=>e.processed))}},mounted(){this.fetchFiles(),this.chartRenderTimeout=setTimeout((()=>{this.renderCharts()}),500)},updated(){this.$nextTick((()=>{this.renderCharts()}))},beforeUnmount(){this.destroyAllCharts(),this.chartRenderTimeout&&clearTimeout(this.chartRenderTimeout)},methods:{...(0,v.i0)(["fetchFiles"]),formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()},destroyAllCharts(){Object.values(this.chartInstances).forEach((e=>{e&&"function"===typeof e.destroy&&e.destroy()})),this.chartInstances={}},renderCharts(){this.destroyAllCharts(),a.e(154).then(a.bind(a,154)).then((e=>{this.$refs&&this.processedFiles.forEach((t=>{const a=`chart-${t.id}`,r=this.$refs[a];if(!r||!r.length)return;const s=r[0];s&&0!==s.offsetWidth&&0!==s.offsetHeight&&this.$store.dispatch("fetchProcessedData",t.id).then((a=>{if(!a||!Array.isArray(a))return void(a&&a.error&&(this.renderEmptyChart(e.default,s,`File cannot be previewed: ${a.error}`),this.$toast?.warning(`File "${t.title}": ${a.error}, please check file content again.`)));if(a.length<=1)return this.renderEmptyChart(e.default,s,"Not enough rows"),void this.$toast?.warning(`File "${t.title}" doesn't have enough data for visualization, please check file content again.`);const r=a[0]?Object.keys(a[0]):[];if(r.length<=1)return this.renderEmptyChart(e.default,s,"Not enough columns"),void this.$toast?.warning(`File "${t.title}" doesn't have enough columns for visualization, please check file content again.`);const i=a.slice(0,5).map((e=>e[r[0]])),n=a.slice(0,5).map((e=>{const t=e[r[1]];return isNaN(t)?100*Math.random():parseFloat(t)}));try{this.chartInstances[t.id]=new e.default(s,{type:"bar",data:{labels:i.length?i:["Cat 1","Cat 2","Cat 3","Cat 4","Cat 5"],datasets:[{label:r[1]||"Sample Data",data:n.length?n:[100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random()],backgroundColor:"#198754"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Preview"}}}})}catch(o){console.error("Error creating chart:",o),this.renderEmptyChart(e.default,s,"Error creating chart")}})).catch((a=>{console.error(`Error fetching data for file ${t.id}:`,a),this.renderEmptyChart(e.default,s,"Cannot load data"),a.response?.data?.error&&this.$toast?.error(`Error with file "${t.title}": ${a.response.data.error}, please check file content again.`)}))}))})).catch((e=>{console.error("Failed to load Chart.js:",e)}))},renderEmptyChart(e,t,a){try{this.chartInstances[`empty-${Date.now()}`]=new e(t,{type:"bar",data:{labels:[""],datasets:[{data:[0],backgroundColor:"#f8f9fa"}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{display:!1,beginAtZero:!0},x:{display:!1}},plugins:{legend:{display:!1},tooltip:{enabled:!1},title:{display:!0,text:a||"No data available",color:"#6c757d",font:{size:14}}}}})}catch(r){console.error("Error creating empty chart:",r)}}}};var C=a(262);const w=(0,C.A)(y,[["render",k],["__scopeId","data-v-220b9a82"]]),L=w}}]);
//# sourceMappingURL=648.2ee90f5c.js.map