"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[822],{822:(e,l,t)=>{t.r(l),t.d(l,{default:()=>B});var i=t(641),a=t(751),s=t(33);const r={class:"upload-view"},o={class:"mb-4"},n={class:"mb-3"},c={class:"mb-3"},d={key:0,class:"alert alert-danger"},u={key:1,class:"alert alert-danger"},p={key:2,class:"alert alert-danger"},f={class:"d-flex gap-2 mb-3"},h={key:3},k={class:"table table-bordered"},b={class:"alert alert-success"};function m(e,l,t,m,g,v){const y=(0,i.g2)("BackButton"),L=(0,i.g2)("router-link"),w=(0,i.g2)("BaseButton"),E=(0,i.g2)("BaseCard");return(0,i.uX)(),(0,i.CE)("div",r,[(0,i.bF)(y),(0,i.Lk)("div",o,[(0,i.bF)(L,{to:"/",class:"btn btn-sm btn-outline-secondary"},{default:(0,i.k6)((()=>l[3]||(l[3]=[(0,i.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,i.eW)(" Back ")]))),_:1}),l[4]||(l[4]=(0,i.Lk)("h2",{class:"mt-3 text-success"},"Upload Greenhouse Data",-1))]),(0,i.bF)(E,{class:"mb-4"},{header:(0,i.k6)((()=>l[5]||(l[5]=[(0,i.Lk)("h5",{class:"card-title mb-0"},"Upload Excel File",-1)]))),default:(0,i.k6)((()=>[(0,i.Lk)("form",{onSubmit:l[2]||(l[2]=(0,a.D$)(((...e)=>v.uploadFile&&v.uploadFile(...e)),["prevent"]))},[(0,i.Lk)("div",n,[l[6]||(l[6]=(0,i.Lk)("label",{for:"title",class:"form-label"},"Title",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":l[0]||(l[0]=e=>g.title=e),placeholder:"Enter a descriptive title for your data",required:""},null,512),[[a.Jo,g.title]]),l[7]||(l[7]=(0,i.Lk)("div",{class:"form-text"},"Give your file a meaningful name related to your greenhouse data.",-1))]),(0,i.Lk)("div",c,[l[8]||(l[8]=(0,i.Lk)("label",{for:"file",class:"form-label"},"Excel File",-1)),(0,i.Lk)("input",{type:"file",class:"form-control",id:"file",onChange:l[1]||(l[1]=(...e)=>v.handleFileChange&&v.handleFileChange(...e)),accept:".xlsx,.xls",required:""},null,32),l[9]||(l[9]=(0,i.Lk)("div",{class:"form-text"},"Accepted formats: .xlsx, .xls (Excel files only)",-1))]),g.fileError?((0,i.uX)(),(0,i.CE)("div",d,[l[10]||(l[10]=(0,i.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),(0,i.eW)(" "+(0,s.v_)(g.fileError),1)])):(0,i.Q3)("",!0),g.previewError?((0,i.uX)(),(0,i.CE)("div",u,[l[11]||(l[11]=(0,i.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),(0,i.eW)(" "+(0,s.v_)(g.previewError),1)])):(0,i.Q3)("",!0),e.error?((0,i.uX)(),(0,i.CE)("div",p,[l[12]||(l[12]=(0,i.Lk)("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),(0,i.eW)(" "+(0,s.v_)("object"===typeof e.error?Object.values(e.error).flat().join(", "):e.error),1)])):(0,i.Q3)("",!0),(0,i.Lk)("div",f,[(0,i.bF)(w,{variant:"info",disabled:!g.file||g.previewLoading,loading:g.previewLoading,onClick:v.previewFile},{default:(0,i.k6)((()=>l[13]||(l[13]=[(0,i.eW)(" Preview Data ")]))),_:1},8,["disabled","loading","onClick"]),(0,i.bF)(w,{variant:"success",disabled:e.loading||!g.file||!g.previewData.length,loading:e.loading,type:"submit"},{default:(0,i.k6)((()=>l[14]||(l[14]=[(0,i.eW)(" Confirm Upload ")]))),_:1},8,["disabled","loading"])]),g.previewData.length?((0,i.uX)(),(0,i.CE)("div",h,[l[15]||(l[15]=(0,i.Lk)("h5",null,"Data Preview (first 5 rows)",-1)),(0,i.Lk)("table",k,[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(Object.keys(g.previewData[0]),(e=>((0,i.uX)(),(0,i.CE)("th",{key:e},(0,s.v_)(e),1)))),128))])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(g.previewData,((e,l)=>((0,i.uX)(),(0,i.CE)("tr",{key:l},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(Object.keys(e),(l=>((0,i.uX)(),(0,i.CE)("td",{key:l},(0,s.v_)(e[l]),1)))),128))])))),128))])])])):(0,i.Q3)("",!0)],32)])),_:1}),(0,i.bF)(E,null,{header:(0,i.k6)((()=>l[16]||(l[16]=[(0,i.Lk)("h5",{class:"card-title mb-0"},"Upload Guidelines",-1)]))),default:(0,i.k6)((()=>[l[21]||(l[21]=(0,i.Lk)("h6",{class:"card-subtitle mb-3 text-success"},"How to prepare your greenhouse data files:",-1)),l[22]||(l[22]=(0,i.Lk)("ul",{class:"list-group list-group-flush mb-3"},[(0,i.Lk)("li",{class:"list-group-item bg-light"},[(0,i.Lk)("i",{class:"bi bi-check-circle-fill text-success me-2"}),(0,i.eW)(" Ensure your Excel file contains greenhouse data in a structured format ")]),(0,i.Lk)("li",{class:"list-group-item bg-light"},[(0,i.Lk)("i",{class:"bi bi-check-circle-fill text-success me-2"}),(0,i.eW)(" Include headers in your Excel file for better data identification ")]),(0,i.Lk)("li",{class:"list-group-item"},[(0,i.Lk)("i",{class:"bi bi-check-circle-fill text-success me-2"}),(0,i.eW)(" Maximum file size: 10MB ")])],-1)),(0,i.Lk)("div",b,[l[18]||(l[18]=(0,i.Lk)("i",{class:"bi bi-info-circle-fill me-2"},null,-1)),l[19]||(l[19]=(0,i.eW)(" After uploading, you can view and analyze your data in the ")),(0,i.bF)(L,{to:"/files",class:"alert-link"},{default:(0,i.k6)((()=>l[17]||(l[17]=[(0,i.eW)("Files section")]))),_:1}),l[20]||(l[20]=(0,i.eW)(". "))])])),_:1})])}var g=t(278),v=t(959),y=t(753),L=t(228);function w(e,l,t,a,s,r){return(0,i.uX)(),(0,i.CE)("button",{onClick:l[0]||(l[0]=(...e)=>r.goBack&&r.goBack(...e)),class:"btn btn-outline-secondary back-button"},l[1]||(l[1]=[(0,i.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,i.eW)(" Back ")]))}const E={name:"BackButton",methods:{goBack(){window.history.length>1?this.$router.go(-1):this.$router.push("/")}}};var x=t(262);const F=(0,x.A)(E,[["render",w],["__scopeId","data-v-c98dc6d2"]]),C=F,$={name:"UploadView",components:{BaseButton:y.A,BaseCard:L.A,BackButton:C},data(){return{title:"",file:null,fileError:null,previewData:[],previewLoading:!1,previewError:null,isUploading:!1,uploadProgress:0}},computed:{...(0,g.aH)(["loading","error"])},methods:{...(0,g.i0)(["uploadFile"]),handleFileChange(e){const l=e.target.files[0];if(this.fileError=null,!l)return void(this.file=null);const t=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];if(!t.includes(l.type))return this.fileError="Invalid file type. Please upload an Excel file (.xlsx or .xls)",void(this.file=null);const i=10485760;if(l.size>i)return this.fileError="File is too large. Maximum size is 10MB",void(this.file=null);this.file=l},async previewFile(){this.previewError=null,this.previewLoading=!0;try{this.previewData=await this.parseExcel(this.file)}catch(e){this.previewError="Failed to parse file"}finally{this.previewLoading=!1}},parseExcel(e){return new Promise(((l,t)=>{const i=new FileReader;i.onload=e=>{const t=new Uint8Array(e.target.result),i=v.LF(t,{type:"array"}),a=i.SheetNames[0],s=i.Sheets[a],r=v.Wp.sheet_to_json(s,{header:1}),o=r[0]||[],n=r.slice(1,6),c=n.map((e=>{const l={};return o.forEach(((t,i)=>{l[t]=e[i]})),l}));l(c)},i.onerror=e=>t(e),i.readAsArrayBuffer(e)}))},async uploadFile(){if(this.file)if(0!==this.file.size){this.isUploading=!0,this.uploadProgress=0;try{const e=new FormData;e.append("title",this.title),e.append("file",this.file);const l=await this.$store.dispatch("uploadFile",e);this.$toast?.success("File uploaded successfully"),l&&l.id?this.$router.push(`/files/${l.id}`):this.$router.push("/files")}catch(e){if(console.error("Upload error:",e.response?.data||e),e.response?.data?.error)this.$toast?.error(`Error: ${e.response.data.error}`);else if(e.response?.data?.detail)this.$toast?.error(`Error: ${e.response.data.detail}`);else if(e.response?.data)if("object"===typeof e.response.data){const l=Object.entries(e.response.data).map((([e,l])=>`${e}: ${l}`)).join(", ");this.$toast?.error(`Validation errors: ${l}`)}else this.$toast?.error(`Error: ${e.response.data}`);else this.$toast?.error("Failed to upload file. Please try again.")}finally{this.isUploading=!1}}else this.$toast?.error("File is empty. Please select a valid file.");else this.$toast?.error("Please select a file to upload")}}},_=(0,x.A)($,[["render",m],["__scopeId","data-v-1b57e29a"]]),B=_}}]);
//# sourceMappingURL=822.dd44f751.js.map