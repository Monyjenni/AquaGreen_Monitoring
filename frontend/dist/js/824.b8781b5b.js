"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[824],{461:(e,s,l)=>{l.d(s,{A:()=>b});var i=l(641),t=l(751);const a={class:"csv-uploader card"},o={class:"card-body"},d={class:"mb-3"},r={class:"mb-3"},n={class:"d-grid gap-2"},c=["disabled"],u={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},p={key:0,class:"alert alert-success mt-3"},h=["disabled"],k={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"};function m(e,s,l,m,F,f){return(0,i.uX)(),(0,i.CE)("div",a,[s[10]||(s[10]=(0,i.Lk)("div",{class:"card-header bg-light"},[(0,i.Lk)("h5",{class:"mb-0"},"Upload CSV Mapping File")],-1)),(0,i.Lk)("div",o,[(0,i.Lk)("form",{onSubmit:s[2]||(s[2]=(0,t.D$)(((...e)=>f.uploadFile&&f.uploadFile(...e)),["prevent"]))},[(0,i.Lk)("div",d,[s[4]||(s[4]=(0,i.Lk)("label",{for:"fileTitle",class:"form-label"},"Title",-1)),(0,i.bo)((0,i.Lk)("input",{type:"text",class:"form-control",id:"fileTitle","onUpdate:modelValue":s[0]||(s[0]=e=>F.title=e),placeholder:"Enter a descriptive title",required:""},null,512),[[t.Jo,F.title]])]),(0,i.Lk)("div",r,[s[5]||(s[5]=(0,i.Lk)("label",{for:"csvFile",class:"form-label"},"CSV File",-1)),(0,i.Lk)("input",{type:"file",class:"form-control",id:"csvFile",onChange:s[1]||(s[1]=(...e)=>f.handleFileSelection&&f.handleFileSelection(...e)),accept:".csv",required:""},null,32),s[6]||(s[6]=(0,i.Lk)("div",{class:"form-text"},"Upload a CSV file with mapping information for crop images.",-1))]),(0,i.Lk)("div",n,[(0,i.Lk)("button",{type:"submit",class:"btn btn-success",disabled:!F.selectedFile||f.loading},[f.loading?((0,i.uX)(),(0,i.CE)("span",u)):(0,i.Q3)("",!0),s[7]||(s[7]=(0,i.eW)(" Upload CSV File "))],8,c)])],32),F.uploadSuccess?((0,i.uX)(),(0,i.CE)("div",p,[s[9]||(s[9]=(0,i.eW)(" CSV file uploaded successfully! ")),(0,i.Lk)("button",{onClick:s[3]||(s[3]=(...e)=>f.processFile&&f.processFile(...e)),class:"btn btn-sm btn-outline-success ms-2",disabled:F.processing},[F.processing?((0,i.uX)(),(0,i.CE)("span",k)):(0,i.Q3)("",!0),s[8]||(s[8]=(0,i.eW)(" Process Now "))],8,h)])):(0,i.Q3)("",!0)])])}var F=l(278);const f={name:"CsvFileUploader",data(){return{title:"",selectedFile:null,uploadSuccess:!1,uploadedFileId:null,processing:!1}},computed:{...(0,F.L8)(["isLoading"]),loading(){return this.isLoading}},methods:{...(0,F.i0)("crop",["uploadCsvFile","processCsvFile"]),handleFileSelection(e){const s=e.target.files[0];s&&(this.selectedFile=s,this.title||(this.title=s.name.replace(/\.csv$/i,"")))},async uploadFile(){if(this.selectedFile)try{const e=new FormData;e.append("name",this.title),e.append("file",this.selectedFile);const s=await this.uploadCsvFile(e);this.uploadSuccess=!0,this.uploadedFileId=s.id,this.$emit("file-uploaded",s),this.$toast?.success("CSV file uploaded successfully!"),this.resetForm()}catch(e){console.error("Error uploading file:",e),this.$toast?.error("Failed to upload file. Please try again.")}},async processFile(){if(this.uploadedFileId){this.processing=!0;try{const e=await this.processCsvFile(this.uploadedFileId);this.$toast?.success(`CSV file processed successfully! ${e.created} records created.`),this.$emit("file-processed",{id:this.uploadedFileId,result:e})}catch(e){console.error("Error processing file:",e),this.$toast?.error("Failed to process file. Please try again.")}finally{this.processing=!1,this.uploadSuccess=!1,this.uploadedFileId=null}}},resetForm(){this.title="",this.selectedFile=null,this.uploadSuccess=!1;const e=document.getElementById("csvFile");e&&(e.value=""),this.$nextTick((()=>{const e=document.querySelector(".csv-uploader");e&&(e.style.opacity="0.99"),setTimeout((()=>{e&&(e.style.opacity="1")}),10)}))}}};var g=l(262);const v=(0,g.A)(f,[["render",m],["__scopeId","data-v-34355260"]]),b=v},824:(e,s,l)=>{l.r(s),l.d(s,{default:()=>V});var i=l(641),t=l(33);const a={class:"csv-files-view"},o={class:"mb-4"},d={class:"row mb-4"},r={class:"col-md-6"},n={class:"col-md-6"},c={class:"d-flex justify-content-between align-items-center"},u={key:0,class:"text-center py-5"},p={key:1,class:"text-center py-5 bg-light rounded"},h={key:2},k={class:"table-responsive"},m={class:"table table-hover"},F={class:"badge bg-info rounded-pill"},f={class:"btn-group btn-group-sm"},g={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"};function v(e,s,l,v,b,L){const C=(0,i.g2)("router-link"),y=(0,i.g2)("csv-file-uploader"),S=(0,i.g2)("base-card"),_=(0,i.g2)("base-button");return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("div",o,[(0,i.bF)(C,{to:"/",class:"btn btn-sm btn-outline-secondary"},{default:(0,i.k6)((()=>s[0]||(s[0]=[(0,i.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,i.eW)(" Back ")]))),_:1}),s[1]||(s[1]=(0,i.Lk)("h2",{class:"mt-3"},"CSV File Management",-1))]),(0,i.Lk)("div",d,[(0,i.Lk)("div",r,[(0,i.bF)(S,{title:"Upload CSV Mapping File"},{default:(0,i.k6)((()=>[(0,i.bF)(y,{onFileUploaded:L.handleFileUploaded,onFileProcessed:L.handleFileProcessed},null,8,["onFileUploaded","onFileProcessed"])])),_:1})]),(0,i.Lk)("div",n,[(0,i.bF)(S,{title:"CSV File Guidelines"},{default:(0,i.k6)((()=>s[2]||(s[2]=[(0,i.Lk)("div",{class:"guidelines"},[(0,i.Lk)("h5",null,"Creating Effective CSV Mapping Files"),(0,i.Lk)("p",null,"Your CSV file should include these key columns:"),(0,i.Lk)("ul",null,[(0,i.Lk)("li",null,[(0,i.Lk)("strong",null,"sample_id"),(0,i.eW)(" - Unique identifier for each crop sample")]),(0,i.Lk)("li",null,[(0,i.Lk)("strong",null,"description"),(0,i.eW)(" (optional) - Description of the crop image")])]),(0,i.Lk)("p",null,"Additional columns will be treated as metadata for the crop images."),(0,i.Lk)("p",null,"Example format:"),(0,i.Lk)("div",{class:"csv-example p-2 rounded bg-light"},[(0,i.Lk)("code",null,"sample_id,description,crop_type,plant_age,health_status"),(0,i.Lk)("br"),(0,i.Lk)("code",null,"CROP_001,Young tomato plant,Tomato,14 days,Healthy"),(0,i.Lk)("br"),(0,i.Lk)("code",null,"CROP_002,Mature lettuce,Lettuce,45 days,Pest damage")])],-1)]))),_:1})])]),(0,i.bF)(S,null,{header:(0,i.k6)((()=>[(0,i.Lk)("div",c,[s[4]||(s[4]=(0,i.Lk)("h5",{class:"mb-0"},"CSV Files",-1)),(0,i.Lk)("div",null,[(0,i.bF)(_,{size:"sm",variant:"outline-primary",onClick:L.refreshFiles,loading:L.loading},{default:(0,i.k6)((()=>s[3]||(s[3]=[(0,i.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,i.eW)(" Refresh ")]))),_:1},8,["onClick","loading"])])])])),default:(0,i.k6)((()=>[L.loading?((0,i.uX)(),(0,i.CE)("div",u,s[5]||(s[5]=[(0,i.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,i.Lk)("span",{class:"visually-hidden"},"Loading...")],-1),(0,i.Lk)("p",{class:"mt-2 text-muted"},"Loading CSV files...",-1)]))):0===L.csvFiles.length?((0,i.uX)(),(0,i.CE)("div",p,s[6]||(s[6]=[(0,i.Lk)("div",{class:"display-1 text-muted mb-3"},[(0,i.Lk)("i",{class:"bi bi-file-earmark-spreadsheet"})],-1),(0,i.Lk)("h4",{class:"text-muted"},"No CSV Files Found",-1),(0,i.Lk)("p",{class:"text-muted"},"Upload CSV mapping files to get started.",-1)]))):((0,i.uX)(),(0,i.CE)("div",h,[(0,i.Lk)("div",k,[(0,i.Lk)("table",m,[s[9]||(s[9]=(0,i.Lk)("thead",{class:"table-light"},[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"File Name"),(0,i.Lk)("th",null,"Uploaded"),(0,i.Lk)("th",null,"Images"),(0,i.Lk)("th",null,"Actions")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(L.csvFiles,(e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,t.v_)(e.name),1),(0,i.Lk)("td",null,(0,t.v_)(L.formatDate(e.uploaded_at)),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",F,(0,t.v_)(e.crop_images_count||0),1)]),(0,i.Lk)("td",null,[(0,i.Lk)("div",f,[(0,i.bF)(_,{variant:"outline-primary",onClick:s=>L.viewRelatedImages(e.id)},{default:(0,i.k6)((()=>s[7]||(s[7]=[(0,i.eW)(" View Images ")]))),_:2},1032,["onClick"]),(0,i.bF)(_,{variant:"outline-success",onClick:s=>L.processFile(e.id),disabled:b.processing===e.id},{default:(0,i.k6)((()=>[b.processing===e.id?((0,i.uX)(),(0,i.CE)("span",g)):(0,i.Q3)("",!0),s[8]||(s[8]=(0,i.eW)(" Process "))])),_:2},1032,["onClick","disabled"])])])])))),128))])])])]))])),_:1})])}var b=l(278),L=l(228),C=l(753),y=l(461);const S={name:"CsvFilesView",components:{BaseCard:L.A,BaseButton:C.A,CsvFileUploader:y.A},data(){return{processing:null}},computed:{...(0,b.L8)("crop",["getCsvFiles","isLoading"]),csvFiles(){return this.getCsvFiles||[]},loading(){return this.isLoading}},mounted(){this.fetchCsvFiles()},methods:{...(0,b.i0)("crop",["fetchCsvFiles","processCsvFile"]),refreshFiles(){this.fetchCsvFiles()},handleFileUploaded(e){this.$toast?.success(`File "${e.title}" uploaded successfully!`),this.refreshFiles()},handleFileProcessed(e){this.$toast?.success(`File processed successfully! ${e.created} records created.`),this.refreshFiles()},async processFile(e){this.processing=e;try{const s=await this.processCsvFile(e);this.$toast?.success(`CSV file processed: ${s.created} created, ${s.updated} updated`),this.refreshFiles()}catch(s){console.error("Error processing file:",s),this.$toast?.error("Failed to process file. Please try again.")}finally{this.processing=null}},viewRelatedImages(e){this.$router.push({name:"crop-images",query:{csv_file:e}})},formatDate(e){if(!e)return"Unknown";const s=new Date(e);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}};var _=l(262);const w=(0,_.A)(S,[["render",v],["__scopeId","data-v-7845f92e"]]),V=w}}]);
//# sourceMappingURL=824.b8781b5b.js.map