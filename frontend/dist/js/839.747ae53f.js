"use strict";(self["webpackChunkdata_processor_frontend"]=self["webpackChunkdata_processor_frontend"]||[]).push([[839],{747:(e,t,l)=>{l.d(t,{A:()=>D});var s=l(641),i=l(751),a=l(33);const o={class:"csv-uploader card"},r={class:"card-body"},n={class:"mb-3"},c={class:"mb-3"},d={key:0,class:"invalid-feedback"},u={class:"d-grid gap-2"},h=["disabled"],p={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},m={key:1,class:"visually-hidden"},f={key:0,class:"alert alert-success mt-3",role:"alert"},C=["disabled"],v={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},b={key:1,class:"visually-hidden"};function k(e,t,l,k,g,y){return(0,s.uX)(),(0,s.CE)("div",o,[t[10]||(t[10]=(0,s.Lk)("div",{class:"card-header bg-light"},[(0,s.Lk)("h5",{class:"mb-0"},"Upload CSV Mapping File")],-1)),(0,s.Lk)("div",r,[(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,i.D$)(((...e)=>y.uploadFile&&y.uploadFile(...e)),["prevent"]))},[(0,s.Lk)("div",n,[t[4]||(t[4]=(0,s.Lk)("label",{for:"fileTitle",class:"form-label"},"Title",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"fileTitle","onUpdate:modelValue":t[0]||(t[0]=e=>g.title=e),placeholder:"Enter a descriptive title",required:""},null,512),[[i.Jo,g.title]])]),(0,s.Lk)("div",c,[t[5]||(t[5]=(0,s.Lk)("label",{for:"csvFile",class:"form-label"},"CSV File",-1)),(0,s.Lk)("input",{type:"file",class:(0,a.C4)(["form-control",{"is-invalid":g.fileError}]),id:"csvFile",onChange:t[1]||(t[1]=(...e)=>y.handleFileSelection&&y.handleFileSelection(...e)),accept:".csv",required:""},null,34),g.fileError?((0,s.uX)(),(0,s.CE)("div",d,(0,a.v_)(g.fileError),1)):(0,s.Q3)("",!0),t[6]||(t[6]=(0,s.Lk)("div",{class:"form-text"},"Upload a CSV file containing sample IDs (like CROP_001, CROP_002) to match with your images.",-1))]),(0,s.Lk)("div",u,[(0,s.Lk)("button",{type:"submit",class:"btn btn-success",disabled:!g.selectedFile||y.loading},[y.loading?((0,s.uX)(),(0,s.CE)("span",p)):(0,s.Q3)("",!0),y.loading?((0,s.uX)(),(0,s.CE)("span",m,"Loading...")):(0,s.Q3)("",!0),t[7]||(t[7]=(0,s.eW)(" Upload CSV File "))],8,h)])],32),g.uploadSuccess?((0,s.uX)(),(0,s.CE)("div",f,[t[9]||(t[9]=(0,s.eW)(" CSV file uploaded successfully! ")),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>y.processFile&&y.processFile(...e)),class:"btn btn-sm btn-outline-success ms-2",disabled:g.processing},[g.processing?((0,s.uX)(),(0,s.CE)("span",v)):(0,s.Q3)("",!0),g.processing?((0,s.uX)(),(0,s.CE)("span",b,"Processing...")):(0,s.Q3)("",!0),t[8]||(t[8]=(0,s.eW)(" Process Now "))],8,C)])):(0,s.Q3)("",!0)])])}var g=l(278);const y={name:"CsvFileUploader",data(){return{title:"",selectedFile:null,uploadSuccess:!1,uploadedFileId:null,processing:!1,fileError:""}},computed:{...(0,g.L8)(["isLoading"]),loading(){return this.isLoading}},methods:{...(0,g.i0)("crop",["uploadCsvFile","processCsvFile"]),handleFileSelection(e){this.fileError="";const t=e.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".csv"))return this.fileError="Please select a valid CSV file",void(this.selectedFile=null);if(t.size>10485760)return this.fileError="File size exceeds the maximum limit of 10MB",void(this.selectedFile=null);const l=new FileReader;l.onload=e=>{try{const l=e.target.result,s=l.split("\n").filter((e=>""!==e.trim()));if(0===s.length)return this.fileError="CSV file appears to be empty",void(this.selectedFile=null);const i=s[0].toLowerCase(),a=i.split(",").length;if(a<2)return this.fileError="CSV file must have at least two columns",void(this.selectedFile=null);if(!i.includes("sample_id"))return this.fileError="CSV file must contain a sample_id column",void(this.selectedFile=null);if(s.length>1)for(let e=1;e<Math.min(5,s.length);e++){const t=s[e].split(",").length;if(t!==a)return this.fileError="CSV file has inconsistent column counts. Please check your data.",void(this.selectedFile=null)}this.selectedFile=t,this.title||(this.title=t.name.replace(/\.csv$/i,""))}catch(l){console.error("Error parsing CSV header:",l),this.fileError="Error reading file. Please try again.",this.selectedFile=null}},l.onerror=()=>{this.fileError="Error reading file. Please try again.",this.selectedFile=null},l.readAsText(t)},async uploadFile(){if(this.selectedFile)try{const e=new FormData;e.append("name",this.title),e.append("file",this.selectedFile);const t=await this.uploadCsvFile(e);this.uploadSuccess=!0,this.uploadedFileId=t.id,this.$emit("file-uploaded",t),this.$toast?.success("CSV file uploaded successfully!"),this.resetForm()}catch(e){console.error("Error uploading file:",e),this.$toast?.error("Failed to upload file. Please try again.")}},async processFile(){if(this.uploadedFileId){this.processing=!0;try{const e=await this.processCsvFile(this.uploadedFileId);this.$toast?.success(`CSV file processed successfully! ${e.created} records created.`),this.$emit("file-processed",{id:this.uploadedFileId,result:e})}catch(e){console.error("Error processing file:",e),this.$toast?.error("Failed to process file. Please try again.")}finally{this.processing=!1,this.uploadSuccess=!1,this.uploadedFileId=null}}},resetForm(){this.title="",this.selectedFile=null,this.uploadSuccess=!1;const e=document.getElementById("csvFile");e&&(e.value=""),this.$nextTick((()=>{const e=document.querySelector(".csv-uploader");e&&(e.style.opacity="0.99"),setTimeout((()=>{e&&(e.style.opacity="1")}),10)}))}}};var F=l(262);const L=(0,F.A)(y,[["render",k],["__scopeId","data-v-bf633c3e"]]),D=L},839:(e,t,l)=>{l.r(t),l.d(t,{default:()=>Fe});var s=l(641),i=l(33),a=l(751);const o={class:"csv-files-container"},r={class:"csv-files-view"},n={class:"mb-4"},c={class:"row mb-4"},d={class:"col-md-6"},u={class:"col-md-6"},h={class:"guidelines"},p={key:0,class:"alert alert-warning alert-dismissible fade show",role:"alert"},m={class:"d-flex justify-content-between align-items-center"},f={key:0,class:"text-center py-5"},C={key:1,class:"text-center py-5 bg-light rounded"},v={key:2},b={class:"table-responsive"},k={class:"table table-hover"},g=["onClick"],y={class:"badge bg-info rounded-pill"},F={class:"btn-group btn-group-sm"},L={key:0,class:"spinner-border spinner-border-sm me-1","aria-hidden":"true"},D={key:1,class:"visually-hidden"},E={key:0,class:"mt-4"},w={key:0,class:"modal fade",tabindex:"-1",style:{display:"block","background-color":"rgba(0,0,0,0.5)"}},_={class:"modal-dialog modal-dialog-centered"},P={class:"modal-content"},S={class:"modal-header"},V={class:"modal-body"},X={class:"modal-footer"},I=["disabled"],T={key:0,class:"spinner-border spinner-border-sm me-1","aria-hidden":"true"},z={key:1,class:"visually-hidden"};function x(e,t,l,x,$,W){const U=(0,s.g2)("router-link"),A=(0,s.g2)("csv-file-uploader"),Q=(0,s.g2)("base-card"),N=(0,s.g2)("base-button"),R=(0,s.g2)("csv-data-visualization");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",r,[(0,s.Lk)("div",n,[(0,s.bF)(U,{to:"/",class:"btn btn-sm btn-outline-secondary"},{default:(0,s.k6)((()=>t[4]||(t[4]=[(0,s.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,s.eW)(" Back ")]))),_:1}),t[5]||(t[5]=(0,s.Lk)("h2",{class:"mt-3"},"CSV File Management",-1))]),(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.bF)(Q,{title:"Upload CSV Mapping File"},{default:(0,s.k6)((()=>[(0,s.bF)(A,{onFileUploaded:W.handleFileUploaded,onFileProcessed:W.handleFileProcessed},null,8,["onFileUploaded","onFileProcessed"])])),_:1})]),(0,s.Lk)("div",u,[(0,s.bF)(Q,{title:"CSV Files Information"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",h,[t[9]||(t[9]=(0,s.Lk)("h5",null,"About CSV Mapping Files",-1)),t[10]||(t[10]=(0,s.Lk)("p",null,"CSV files are used to link metadata to crop images:",-1)),t[11]||(t[11]=(0,s.Lk)("ul",null,[(0,s.Lk)("li",null,[(0,s.Lk)("strong",null,"Required:"),(0,s.eW)(" A 'sample_id' column is required to match images")]),(0,s.Lk)("li",null,[(0,s.Lk)("strong",null,"Processing:"),(0,s.eW)(" After uploading, click 'Process' to analyze the file")]),(0,s.Lk)("li",null,[(0,s.Lk)("strong",null,"Delete:"),(0,s.eW)(" You can remove files that are no longer needed")])],-1)),$.showDeletionWarning?((0,s.uX)(),(0,s.CE)("div",p,[t[6]||(t[6]=(0,s.Lk)("i",{class:"bi bi-info-circle me-2"},null,-1)),t[7]||(t[7]=(0,s.Lk)("strong",null,"Note:",-1)),t[8]||(t[8]=(0,s.eW)(" CSV files linked to images cannot be deleted until the link is removed. ")),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=e=>$.showDeletionWarning=!1),"aria-label":"Close"})])):(0,s.Q3)("",!0)])])),_:1})])]),(0,s.bF)(Q,null,{header:(0,s.k6)((()=>[(0,s.Lk)("div",m,[t[13]||(t[13]=(0,s.Lk)("h5",{class:"mb-0"},"CSV Files",-1)),(0,s.Lk)("div",null,[(0,s.bF)(N,{size:"sm",variant:"outline-primary",onClick:W.refreshFiles,loading:W.loading},{default:(0,s.k6)((()=>t[12]||(t[12]=[(0,s.Lk)("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),(0,s.eW)(" Refresh ")]))),_:1},8,["onClick","loading"])])])])),default:(0,s.k6)((()=>[W.loading?((0,s.uX)(),(0,s.CE)("div",f,t[14]||(t[14]=[(0,s.Lk)("div",{class:"spinner-border text-primary","aria-hidden":"true"},null,-1),(0,s.Lk)("span",{class:"visually-hidden"},"Loading...",-1),(0,s.Lk)("p",{class:"mt-2 text-muted"},"Loading CSV files...",-1)]))):0===W.csvFiles.length?((0,s.uX)(),(0,s.CE)("div",C,t[15]||(t[15]=[(0,s.Lk)("div",{class:"display-1 text-muted mb-3"},[(0,s.Lk)("i",{class:"bi bi-file-earmark-spreadsheet"})],-1),(0,s.Lk)("h4",{class:"text-muted"},"No CSV Files Found",-1),(0,s.Lk)("p",{class:"text-muted"},"Upload CSV mapping files to get started.",-1)]))):((0,s.uX)(),(0,s.CE)("div",v,[(0,s.Lk)("div",b,[(0,s.Lk)("table",k,[t[19]||(t[19]=(0,s.Lk)("thead",{class:"table-light"},[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"File Name"),(0,s.Lk)("th",null,"Uploaded"),(0,s.Lk)("th",null,"Images"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(W.csvFiles,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:(0,i.C4)({"selected-row":$.selectedFileId===e.id}),onClick:t=>W.toggleFileSelection(e.id)},[(0,s.Lk)("td",null,(0,i.v_)(e.name),1),(0,s.Lk)("td",null,(0,i.v_)(W.formatDate(e.uploaded_at)),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",y,(0,i.v_)(e.crop_images_count||0),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",F,[(0,s.bF)(N,{variant:"outline-primary",onClick:(0,a.D$)((t=>W.viewRelatedImages(e.id)),["stop"])},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)(" View Images ")]))),_:2},1032,["onClick"]),(0,s.bF)(N,{variant:"outline-success",onClick:(0,a.D$)((t=>W.processFile(e.id)),["stop"]),disabled:$.processing===e.id},{default:(0,s.k6)((()=>[$.processing===e.id?((0,s.uX)(),(0,s.CE)("span",L)):(0,s.Q3)("",!0),$.processing===e.id?((0,s.uX)(),(0,s.CE)("span",D,"Processing file...")):(0,s.Q3)("",!0),t[17]||(t[17]=(0,s.eW)(" Process "))])),_:2},1032,["onClick","disabled"]),(0,s.bF)(N,{variant:"outline-info",onClick:(0,a.D$)((t=>W.toggleFileSelection(e.id)),["stop"])},{default:(0,s.k6)((()=>[t[18]||(t[18]=(0,s.Lk)("i",{class:"bi bi-bar-chart-line me-1"},null,-1)),(0,s.eW)(" "+(0,i.v_)($.selectedFileId===e.id?"Hide Chart":"Show Chart"),1)])),_:2},1032,["onClick"])])])],10,g)))),128))])])]),(0,s.bF)(a.eB,{name:"fade"},{default:(0,s.k6)((()=>[$.selectedFileId?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.bF)(Q,null,{header:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.Lk)("h5",{class:"mb-0"},"CSV Data Visualization",-1)]))),default:(0,s.k6)((()=>[(0,s.bF)(R,{"selected-file-id":$.selectedFileId,onDataLoaded:W.handleDataLoaded},null,8,["selected-file-id","onDataLoaded"])])),_:1})])):(0,s.Q3)("",!0)])),_:1})]))])),_:1})]),$.showDeleteConfirmation?((0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("div",_,[(0,s.Lk)("div",P,[(0,s.Lk)("div",S,[t[21]||(t[21]=(0,s.Lk)("h5",{class:"modal-title"},"Confirm Deletion",-1)),(0,s.Lk)("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:t[1]||(t[1]=(...e)=>W.cancelDelete&&W.cancelDelete(...e))})]),(0,s.Lk)("div",V,[(0,s.Lk)("p",null,[t[22]||(t[22]=(0,s.eW)("Are you sure you want to delete the CSV file ")),(0,s.Lk)("strong",null,(0,i.v_)($.fileToDelete?.name),1),t[23]||(t[23]=(0,s.eW)("?"))]),t[24]||(t[24]=(0,s.Lk)("p",{class:"text-danger"},"This action cannot be undone and may affect related crop images.",-1))]),(0,s.Lk)("div",X,[(0,s.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=(...e)=>W.cancelDelete&&W.cancelDelete(...e))},"Cancel"),(0,s.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[3]||(t[3]=(...e)=>W.deleteFile&&W.deleteFile(...e)),disabled:$.deleting},[$.deleting?((0,s.uX)(),(0,s.CE)("span",T)):(0,s.Q3)("",!0),$.deleting?((0,s.uX)(),(0,s.CE)("span",z,"Deleting file...")):(0,s.Q3)("",!0),t[25]||(t[25]=(0,s.eW)(" Delete "))],8,I)])])])])):(0,s.Q3)("",!0)])}var $=l(278),W=l(228),U=l(753),A=l(747);const Q={class:"csv-data-visualization"},N={key:0,class:"mb-4"},R={class:"visualization-presets mb-3"},B=["value"],M={key:0,class:"preset-info mt-2 text-muted small"},K={class:"chart-type-selection mb-3"},q=["value"],G={class:"column-filter mb-2"},O={class:"column-selection mb-3"},j={class:"column-chips"},H=["onClick"],Y={class:"form-text mt-2"},J={key:0},Z={key:1},ee={key:0,class:"mt-2 text-info"},te=["disabled"],le={key:0,class:"spinner-border spinner-border-sm me-2"},se={key:1,class:"bi bi-graph-up me-2"},ie={key:1,class:"chart-container"},ae={key:0,class:"chart-loading"},oe={key:1},re={key:0,class:"table-responsive"},ne={class:"table table-sm table-hover"},ce={key:0,class:"text-muted text-center mt-2"},de={key:1,class:"alert alert-info"},ue={key:2,class:"chart-container"},he={ref:"chartCanvas"},pe={key:2,class:"alert alert-light text-center p-5"};function me(e,t,l,o,r,n){return(0,s.uX)(),(0,s.CE)("div",Q,[l.selectedFileId?((0,s.uX)(),(0,s.CE)("div",N,[t[10]||(t[10]=(0,s.Lk)("h5",null,"CSV Data Visualization",-1)),(0,s.Lk)("div",R,[t[5]||(t[5]=(0,s.Lk)("label",{for:"visualizationPreset"},"Visualization Preset:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"visualizationPreset",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedPreset=e)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.visualizationPresets,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,i.v_)(e.label),9,B)))),128))],512),[[a.u1,r.selectedPreset]]),"custom"!==r.selectedPreset?((0,s.uX)(),(0,s.CE)("div",M,t[4]||(t[4]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.eW)(" Using preset visualization. Selected columns will be updated automatically. ")]))):(0,s.Q3)("",!0)]),(0,s.Lk)("div",K,[t[6]||(t[6]=(0,s.Lk)("label",{for:"chartType"},"Chart Type:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"chartType",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>r.chartType=e)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.availableChartTypes,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,i.v_)(e.label),9,q)))),128))],512),[[a.u1,r.chartType]])]),(0,s.Lk)("div",G,[t[7]||(t[7]=(0,s.Lk)("label",{for:"columnFilter"},"Filter Columns:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"columnFilter",type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>r.filterValue=e),placeholder:"Type to filter columns..."},null,512),[[a.Jo,r.filterValue]])]),(0,s.Lk)("div",O,[t[9]||(t[9]=(0,s.Lk)("label",null,"Select Columns for Visualization:",-1)),(0,s.Lk)("div",j,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredColumns,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:(0,i.C4)(["column-chip",{selected:r.selectedColumns.includes(e)}]),onClick:t=>n.toggleColumn(e)},(0,i.v_)(e),11,H)))),128))]),(0,s.Lk)("small",Y,[0===r.selectedColumns.length?((0,s.uX)(),(0,s.CE)("span",J,"Select columns to visualize data")):((0,s.uX)(),(0,s.CE)("span",Z,"Selected "+(0,i.v_)(r.selectedColumns.length)+" column(s)",1))]),"custom"!==r.selectedPreset?((0,s.uX)(),(0,s.CE)("div",ee,[t[8]||(t[8]=(0,s.Lk)("i",{class:"bi bi-info-circle"},null,-1)),(0,s.eW)(" Using preset: "+(0,i.v_)(r.visualizationPresets.find((e=>e.value===r.selectedPreset))?.label),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{class:"btn btn-success",onClick:t[3]||(t[3]=(...e)=>n.fetchData&&n.fetchData(...e)),disabled:!n.canFetchData||n.loading},[n.loading?((0,s.uX)(),(0,s.CE)("span",le)):((0,s.uX)(),(0,s.CE)("i",se)),(0,s.eW)(" "+(0,i.v_)(r.dataLoaded?"Update Chart":"Generate Chart"),1)],8,te)])):(0,s.Q3)("",!0),r.dataLoaded?((0,s.uX)(),(0,s.CE)("div",ie,[n.loading?((0,s.uX)(),(0,s.CE)("div",ae,t[11]||(t[11]=[(0,s.Lk)("div",{class:"spinner-border text-primary"},null,-1),(0,s.Lk)("p",{class:"mt-2"},"Loading chart data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",oe,["table"===r.chartType?((0,s.uX)(),(0,s.CE)("div",re,[(0,s.Lk)("table",ne,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.selectedColumns,(e=>((0,s.uX)(),(0,s.CE)("th",{key:e},(0,i.v_)(e),1)))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.csvData.slice(0,100),((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.selectedColumns,(t=>((0,s.uX)(),(0,s.CE)("td",{key:t},(0,i.v_)(e[t]),1)))),128))])))),128))])]),n.csvData.length>100?((0,s.uX)(),(0,s.CE)("div",ce," Showing first 100 rows of "+(0,i.v_)(n.csvData.length)+" total ",1)):(0,s.Q3)("",!0)])):n.canVisualize?((0,s.uX)(),(0,s.CE)("div",ue,[(0,s.Lk)("canvas",he,null,512)])):((0,s.uX)(),(0,s.CE)("div",de,t[12]||(t[12]=[(0,s.Lk)("i",{class:"bi bi-info-circle me-2"},null,-1),(0,s.eW)(" The selected columns cannot be visualized with the current chart type. Please select different columns or chart type. ")])))]))])):l.selectedFileId&&!n.loading?((0,s.uX)(),(0,s.CE)("div",pe,t[13]||(t[13]=[(0,s.Lk)("i",{class:"bi bi-file-earmark-bar-graph display-4 text-muted"},null,-1),(0,s.Lk)("h5",{class:"mt-3"},"No Data Visualized Yet",-1),(0,s.Lk)("p",{class:"text-muted"},'Select columns and click "Generate Chart" to visualize your data.',-1)]))):(0,s.Q3)("",!0)])}var fe=l(468);fe.Chart.register(...fe.registerables);const Ce={name:"CsvDataVisualization",props:{selectedFileId:{type:[Number,String],default:null}},beforeDestroy(){this.chart&&this.chart.destroy()},data(){return{selectedColumns:[],dataLoaded:!1,chartType:"table",availableChartTypes:[{label:"Table",value:"table"},{label:"Bar Chart",value:"bar"},{label:"Line Chart",value:"line"},{label:"Scatter Plot",value:"scatter"},{label:"Pie Chart",value:"pie"}],visualizationPresets:[{label:"Custom (Manual Selection)",value:"custom"},{label:"Crop Distribution",value:"crop_distribution",columns:["crop_type"]},{label:"Growth Stage Distribution",value:"growth_stage",columns:["growth_stage"]},{label:"Health Score Categories",value:"health_score",columns:["health_score"]},{label:"Leaf Count vs Health Score",value:"leaf_count_health",columns:["leaf_count","health_score"]},{label:"Growth Production",value:"nethouse",columns:["nethouse_id"]}],selectedPreset:"custom",filterValue:"",chart:null}},computed:{...(0,$.L8)("crop",["getCsvColumns","getCsvColumnTypes","getCsvData","isLoading","getError"]),filteredColumns(){if(!this.filterValue)return this.availableColumns;const e=this.filterValue.toLowerCase();return this.availableColumns.filter((t=>t.toLowerCase().includes(e)))},columnTypes(){return this.getCsvColumnTypes||{}},csvData(){return this.getCsvData||[]},loading(){return this.isLoading},canFetchData(){return this.selectedFileId&&!this.loading},canVisualize(){return this.dataLoaded&&this.selectedColumns.length>0}},watch:{selectedColumns:{handler(){this.canVisualize&&this.createChart()},deep:!0},chartType(){this.canVisualize&&this.createChart()},selectedPreset(){this.applyPreset()},selectedFileId:{immediate:!0,handler(e){e?this.fetchColumnInfo():(this.selectedColumns=[],this.dataLoaded=!1)}},csvData:{handler(){this.dataLoaded&&"table"!==this.chartType&&this.$nextTick((()=>{this.createChart()}))}}},methods:{...(0,$.i0)("crop",["fetchCsvFilePreview","fetchCsvData"]),applyPreset(){if("custom"===this.selectedPreset)return void(this.selectedColumns=[]);const e=this.visualizationPresets.find((e=>e.value===this.selectedPreset));if(!e||!e.columns)return;const t=e.columns.filter((e=>this.availableColumns.includes(e)));switch(this.selectedColumns=t,this.selectedPreset){case"crop_distribution":case"growth_stage":case"health_score":this.chartType="pie";break;case"leaf_count_health":this.chartType="scatter";break;case"nethouse":this.chartType="bar";break;default:break}t.length>0&&this.canFetchData&&this.fetchData()},async fetchColumnInfo(){if(this.selectedFileId)try{this.selectedColumns=[],this.dataLoaded=!1;const e=await this.fetchCsvFilePreview(this.selectedFileId);e.columns&&e.columns.includes("sample_id")&&(this.selectedColumns=["sample_id"])}catch(e){console.error("Error fetching CSV column info:",e),this.$toast?.error("Failed to fetch CSV column information")}},toggleColumn(e){const t=this.selectedColumns.indexOf(e);-1===t?this.selectedColumns.push(e):this.selectedColumns.splice(t,1)},async fetchData(){if(this.canFetchData)try{await this.fetchCsvData({fileId:this.selectedFileId,selectedColumns:this.selectedColumns}),this.dataLoaded=!0,this.$emit("data-loaded",{columns:this.selectedColumns,data:this.csvData}),"table"!==this.chartType&&this.$nextTick((()=>{this.createChart()}))}catch(e){console.error("Error fetching CSV data:",e),this.$toast?.error("Failed to fetch CSV data")}},createChart(){this.chart&&this.chart.destroy();const e=this.$refs.chartCanvas;if(!e)return;if("pie"===this.chartType)return void this.createPieChart(e);const t=this.selectedColumns.filter((e=>"numeric"===this.columnTypes[e]));if(0===t.length)return void console.warn("No numeric columns found for chart visualization");const l=this.prepareChartData(t);let s=`CSV Data Visualization (${this.chartType})`;if("custom"!==this.selectedPreset){const e=this.visualizationPresets.find((e=>e.value===this.selectedPreset));e&&(s=e.label)}this.chart=new fe.Chart(e,{type:this.chartType,data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:s,font:{size:16}},tooltip:{mode:"index",intersect:!1},legend:{position:"top"}},scales:{y:{beginAtZero:!0}}}})},createPieChart(e){if(!this.selectedColumns.length)return void console.error("No column selected for pie chart");const t=this.selectedColumns[0],l=this.preparePieChartData(t);let s="Distribution of "+t;if("custom"!==this.selectedPreset){const e=this.visualizationPresets.find((e=>e.value===this.selectedPreset));e&&(s=e.label)}this.chart=new fe.Chart(e,{type:"pie",data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},title:{display:!0,text:s,font:{size:16}},tooltip:{callbacks:{label:e=>{const t=e.label||"",l=e.raw||0,s=e.chart.data.datasets[0].data.reduce(((e,t)=>e+t),0),i=Math.round(100*l/s)+"%";return`${t}: ${l} (${i})`}}}}}})},preparePieChartData(e){const t={};this.csvData.forEach((l=>{let s;s="processed"===e.toLowerCase()?l[e]?"Yes":"No":l[e]||"N/A",t[s]||(t[s]=0),t[s]++}));const l=Object.keys(t),s=l.map((e=>t[e])),i=l.map(((e,t)=>{const l=t%this.colorPalette.length;return this.colorPalette[l]}));return{labels:l,datasets:[{data:s,backgroundColor:i,borderWidth:1}]}},prepareChartData(e){const t=this.selectedColumns.filter((e=>"string"===this.columnTypes[e]||"date"===this.columnTypes[e]));if("bar"===this.chartType&&"nethouse"===this.selectedPreset)return this.prepareNethouseBarData();let l=[];l=t.length>0?this.csvData.map((e=>e[t[0]])):this.csvData.map(((e,t)=>`Row ${t+1}`));const s=e.map(((e,t)=>{const l=t%this.colorPalette.length,s=this.colorPalette[l];return{label:e,data:this.csvData.map((t=>parseFloat(t[e])||0)),backgroundColor:s.replace("1.0","0.2"),borderColor:s,borderWidth:1}}));return{labels:l,datasets:s}},prepareNethouseBarData(){const e=this.selectedColumns.find((e=>e.toLowerCase().includes("nethouse")||e.toLowerCase().includes("net_house")||e.toLowerCase().includes("house_id")))||"nethouse_id",t={};this.csvData.forEach((l=>{const s=l[e]||"N/A";t[s]||(t[s]=0),t[s]++}));const l=Object.keys(t);l.sort(((e,t)=>{const l=parseInt(e,10),s=parseInt(t,10);return isNaN(l)||isNaN(s)?e.localeCompare(t):l-s}));const s=l.map((e=>t[e])),i={label:"Growth Production Data",data:s,backgroundColor:l.map(((e,t)=>this.colorPalette[t%this.colorPalette.length].replace("1.0","0.6"))),borderColor:l.map(((e,t)=>this.colorPalette[t%this.colorPalette.length])),borderWidth:1};return{labels:l,datasets:[i]}}}};var ve=l(262);const be=(0,ve.A)(Ce,[["render",me],["__scopeId","data-v-022227d0"]]),ke=be,ge={name:"CsvFilesView",components:{BaseCard:W.A,BaseButton:U.A,CsvFileUploader:A.A,CsvDataVisualization:ke},data(){return{processing:null,fileToDelete:null,showDeleteConfirmation:!1,deleting:!1,showDeletionWarning:!1,selectedFileId:null,visualizationData:null}},computed:{...(0,$.L8)("crop",["getCsvFiles","isLoading","getError"]),csvFiles(){return this.getCsvFiles||[]},loading(){return this.isLoading}},mounted(){this.fetchCsvFiles()},methods:{...(0,$.i0)("crop",["fetchCsvFiles","processCsvFile","deleteCsvFile"]),refreshFiles(){this.fetchCsvFiles()},handleFileUploaded(){this.fetchCsvFiles()},handleFileProcessed(){this.fetchCsvFiles()},viewRelatedImages(e){this.$router.push({name:"CropImagesView",query:{csv_file:e}})},async processFile(e){this.processing=e;try{await this.processCsvFile(e),this.fetchCsvFiles()}catch(t){console.error("Error processing file:",t)}finally{this.processing=null}},toggleFileSelection(e){this.selectedFileId===e?(this.selectedFileId=null,this.visualizationData=null):this.selectedFileId=e},handleDataLoaded(e){this.visualizationData=e},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleString()},confirmDelete(e){this.fileToDelete=e,this.showDeleteConfirmation=!0},cancelDelete(){this.fileToDelete=null,this.showDeleteConfirmation=!1},async deleteFile(){this.deleting=!0;const e=await this.$store.dispatch("deleteCsvFile",this.fileToDelete.id);e.success?(this.showDeleteConfirmation=!1,this.fileToDelete=null,this.$toast.success("File deleted successfully"),this.refreshFiles()):(console.error("Error deleting file:",e.error),e.linkedToImages?(this.showDeletionWarning=!0,this.$toast.error(e.error,{timeout:6e3}),setTimeout((()=>{this.viewRelatedImages(this.fileToDelete.id)}),1500)):this.$toast.error(`Error deleting file: ${e.error}`)),this.deleting=!1,this.showDeleteConfirmation=!1}}},ye=(0,ve.A)(ge,[["render",x],["__scopeId","data-v-06748ec9"]]),Fe=ye}}]);
//# sourceMappingURL=839.747ae53f.js.map